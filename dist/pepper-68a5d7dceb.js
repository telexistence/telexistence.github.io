function getQueryString(){if(1<document.location.search.length){for(var t=document.location.search.substring(1),e=t.split("&"),n=new Object,r=0;r<e.length;r++){var i=e[r].split("="),o=decodeURIComponent(i[0]),a=decodeURIComponent(i[1]);n[o]=decodeURIComponent(a)}return n}return null}!function(t){function e(){this._events={},this._conf&&n.call(this,this._conf)}function n(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function r(t){this._events={},this.newListener=!1,n.call(this,t)}function i(t,e,n,r){if(!n)return[];var o,a,s,u,c,f,l,h=[],p=e.length,d=e[r],_=e[r+1];if(r===p&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(o=0,a=n._listeners.length;a>o;o++)t&&t.push(n._listeners[o]);return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&(h=h.concat(i(t,e,n[s],r+1)));return h}if("**"===d){l=r+1===p||r+2===p&&"*"===_,l&&n._listeners&&(h=h.concat(i(t,e,n,p)));for(s in n)"_listeners"!==s&&n.hasOwnProperty(s)&&("*"===s||"**"===s?(n[s]._listeners&&!l&&(h=h.concat(i(t,e,n[s],p))),h=h.concat(i(t,e,n[s],r))):h=s===_?h.concat(i(t,e,n[s],r+2)):h.concat(i(t,e,n[s],r)));return h}h=h.concat(i(t,e,n[d],r+1))}if(u=n["*"],u&&i(t,e,u,r+1),c=n["**"])if(p>r){c._listeners&&i(t,e,c,p);for(s in c)"_listeners"!==s&&c.hasOwnProperty(s)&&(s===_?i(t,e,c[s],r+2):s===d?i(t,e,c[s],r+1):(f={},f[s]=c[s],i(t,e,{"**":f},r+1)))}else c._listeners?i(t,e,c,p):c["*"]&&c["*"]._listeners&&i(t,e,c["*"],p);return h}function o(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;r>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var i=this.listenerTree,o=t.shift();o;){if(i[o]||(i[o]={}),i=i[o],0===t.length){if(i._listeners){if("function"==typeof i._listeners)i._listeners=[i._listeners,e];else if(a(i._listeners)&&(i._listeners.push(e),!i._listeners.warned)){var u=s;"undefined"!=typeof this._events.maxListeners&&(u=this._events.maxListeners),u>0&&i._listeners.length>u&&(i._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",i._listeners.length),console.trace())}}else i._listeners=e;return!0}o=t.shift()}return!0}var a=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},s=10;r.prototype.delimiter=".",r.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},r.prototype.event="",r.prototype.once=function(t,e){return this.many(t,1,e),this},r.prototype.many=function(t,e,n){function r(){0===--e&&i.off(t,r),n.apply(this,arguments)}var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(t,r),i},r.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(o=0,n=this._all.length;n>o;o++)this.event=t,this._all[o].apply(this,r)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var a;if(this.wildcard){a=[];var s="string"==typeof t?t.split(this.delimiter):t.slice();i.call(this,a,s,this.listenerTree,0)}else a=this._events[t];if("function"==typeof a){if(this.event=t,1===arguments.length)a.call(this);else if(arguments.length>1)switch(arguments.length){case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];a.apply(this,r)}return!0}if(a){for(var n=arguments.length,r=new Array(n-1),o=1;n>o;o++)r[o-1]=arguments[o];for(var u=a.slice(),o=0,n=u.length;n>o;o++)this.event=t,u[o].apply(this,r);return u.length>0||!!this._all}return!!this._all},r.prototype.on=function(t,n){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,n),this.wildcard)return o.call(this,t,n),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],n];else if(a(this._events[t])&&(this._events[t].push(n),!this._events[t].warned)){var r=s;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=n;return this},r.prototype.onAny=function(t){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(t),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var o="string"==typeof t?t.split(this.delimiter):t.slice();r=i.call(this,null,o,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],r.push({_listeners:n})}for(var s=0;s<r.length;s++){var u=r[s];if(n=u._listeners,a(n)){for(var c=-1,f=0,l=n.length;l>f;f++)if(n[f]===e||n[f].listener&&n[f].listener===e||n[f]._origin&&n[f]._origin===e){c=f;break}if(0>c)continue;return this.wildcard?u._listeners.splice(c,1):this._events[t].splice(c,1),0===n.length&&(this.wildcard?delete u._listeners:delete this._events[t]),this}(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete u._listeners:delete this._events[t])}return this},r.prototype.offAny=function(t){var e,n=0,r=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,r=e.length;r>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var n="string"==typeof t?t.split(this.delimiter):t.slice(),r=i.call(this,null,n,this.listenerTree,0),o=0;o<r.length;o++){var a=r[o];a._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],r="string"==typeof t?t.split(this.delimiter):t.slice();return i.call(this,n,r,this.listenerTree,0),n}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),a(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof exports?exports.EventEmitter2=r:window.EventEmitter2=r}(),function(){var t,e,n,r,i,o,a;r=function(t,e){var n,r,i,o;i=[];for(r in e.prototype)try{o=e.prototype[r],null==t[r]&&"function"!=typeof o?i.push(t[r]=o):i.push(void 0)}catch(a){n=a}return i},t={},t.options=window.Offline?window.Offline.options||{}:{},n={checks:{xhr:{url:function(){return"/favicon.ico?_="+(new Date).getTime()},timeout:5e3,type:"HEAD"},image:{url:function(){return"/favicon.ico?_="+(new Date).getTime()}},active:"xhr"},checkOnLoad:!1,interceptRequests:!0,reconnect:!0,deDupBody:!1},i=function(t,e){var n,r,i,o,a,s;for(n=t,s=e.split("."),r=i=0,o=s.length;o>i&&(a=s[r],n=n[a],"object"==typeof n);r=++i);return r===s.length-1?n:void 0},t.getOption=function(e){var r,o;return o=null!=(r=i(t.options,e))?r:i(n,e),"function"==typeof o?o():o},"function"==typeof window.addEventListener&&window.addEventListener("online",function(){return setTimeout(t.confirmUp,100)},!1),"function"==typeof window.addEventListener&&window.addEventListener("offline",function(){return t.confirmDown()},!1),t.state="up",t.markUp=function(){return t.trigger("confirmed-up"),"up"!==t.state?(t.state="up",t.trigger("up")):void 0},t.markDown=function(){return t.trigger("confirmed-down"),"down"!==t.state?(t.state="down",t.trigger("down")):void 0},o={},t.on=function(e,n,r){var i,a,s,u,c;if(a=e.split(" "),a.length>1){for(c=[],s=0,u=a.length;u>s;s++)i=a[s],c.push(t.on(i,n,r));return c}return null==o[e]&&(o[e]=[]),o[e].push([r,n])},t.off=function(t,e){var n,r,i,a,s;if(null!=o[t]){if(e){for(i=0,s=[];i<o[t].length;)a=o[t][i],r=a[0],n=a[1],n===e?s.push(o[t].splice(i,1)):s.push(i++);return s}return o[t]=[]}},t.trigger=function(t){var e,n,r,i,a,s,u;if(null!=o[t]){for(a=o[t],u=[],r=0,i=a.length;i>r;r++)s=a[r],e=s[0],n=s[1],u.push(n.call(e));return u}},e=function(t,e,n){var r,i,o,a,s;return s=function(){return t.status&&t.status<12e3?e():n()},null===t.onprogress?(r=t.onerror,t.onerror=function(){return n(),"function"==typeof r?r.apply(null,arguments):void 0},a=t.ontimeout,t.ontimeout=function(){return n(),"function"==typeof a?a.apply(null,arguments):void 0},i=t.onload,t.onload=function(){return s(),"function"==typeof i?i.apply(null,arguments):void 0}):(o=t.onreadystatechange,t.onreadystatechange=function(){return 4===t.readyState?s():0===t.readyState&&n(),"function"==typeof o?o.apply(null,arguments):void 0})},t.checks={},t.checks.xhr=function(){var n,r;r=new XMLHttpRequest,r.offline=!1,r.open(t.getOption("checks.xhr.type"),t.getOption("checks.xhr.url"),!0),null!=r.timeout&&(r.timeout=t.getOption("checks.xhr.timeout")),e(r,t.markUp,t.markDown);try{r.send()}catch(i){n=i,t.markDown()}return r},t.checks.image=function(){var e;return e=document.createElement("img"),e.onerror=t.markDown,e.onload=t.markUp,void(e.src=t.getOption("checks.image.url"))},t.checks.down=t.markDown,t.checks.up=t.markUp,t.check=function(){return t.trigger("checking"),t.checks[t.getOption("checks.active")]()},t.confirmUp=t.confirmDown=t.check,t.onXHR=function(t){var e,n,i;return i=function(e,n){var r;return r=e.open,e.open=function(i,o,a,s,u){return t({type:i,url:o,async:a,flags:n,user:s,password:u,xhr:e}),r.apply(e,arguments)}},n=window.XMLHttpRequest,window.XMLHttpRequest=function(t){var e,r,o;return o=new n(t),i(o,t),r=o.setRequestHeader,o.headers={},o.setRequestHeader=function(t,e){return o.headers[t]=e,r.call(o,t,e)},e=o.overrideMimeType,o.overrideMimeType=function(t){return o.mimeType=t,e.call(o,t)},o},r(window.XMLHttpRequest,n),null!=window.XDomainRequest?(e=window.XDomainRequest,window.XDomainRequest=function(){var t;return t=new e,i(t),t},r(window.XDomainRequest,e)):void 0},a=function(){return t.getOption("interceptRequests")&&t.onXHR(function(n){var r;return r=n.xhr,r.offline!==!1?e(r,t.markUp,t.confirmDown):void 0}),t.getOption("checkOnLoad")?t.check():void 0},setTimeout(a,0),window.Offline=t}.call(this),function(){var t,e,n,r,i,o,a,s,u;if(!window.Offline)throw new Error("Offline Reconnect brought in without offline.js");r=Offline.reconnect={},o=null,i=function(){var t;return null!=r.state&&"inactive"!==r.state&&Offline.trigger("reconnect:stopped"),r.state="inactive",r.remaining=r.delay=null!=(t=Offline.getOption("reconnect.initialDelay"))?t:3},e=function(){var t,e;return t=null!=(e=Offline.getOption("reconnect.delay"))?e:Math.min(Math.ceil(1.5*r.delay),3600),r.remaining=r.delay=t},a=function(){return"connecting"!==r.state?(r.remaining-=1,Offline.trigger("reconnect:tick"),0===r.remaining?s():void 0):void 0},s=function(){return"waiting"===r.state?(Offline.trigger("reconnect:connecting"),r.state="connecting",Offline.check()):void 0},t=function(){return Offline.getOption("reconnect")?(i(),r.state="waiting",Offline.trigger("reconnect:started"),o=setInterval(a,1e3)):void 0},u=function(){return null!=o&&clearInterval(o),i()},n=function(){return Offline.getOption("reconnect")&&"connecting"===r.state?(Offline.trigger("reconnect:failure"),r.state="waiting",e()):void 0},r.tryNow=s,i(),Offline.on("down",t),Offline.on("confirmed-down",n),Offline.on("up",u)}.call(this),function(){var t,e,n,r,i,o;if(!window.Offline)throw new Error("Requests module brought in without offline.js");n=[],o=!1,r=function(t){return Offline.getOption("requests")!==!1?(Offline.trigger("requests:capture"),"down"!==Offline.state&&(o=!0),n.push(t)):void 0},i=function(t){var e,n,r,i,o,a,s,u,c;if(c=t.xhr,a=t.url,o=t.type,s=t.user,r=t.password,e=t.body,Offline.getOption("requests")!==!1){c.abort(),c.open(o,a,!0,s,r),i=c.headers;for(n in i)u=i[n],c.setRequestHeader(n,u);return c.mimeType&&c.overrideMimeType(c.mimeType),c.send(e)}},t=function(){return n=[]},e=function(){var e,r,o,a,s,u,c;if(Offline.getOption("requests")!==!1){for(Offline.trigger("requests:flush"),u={},r=0,a=n.length;a>r;r++)s=n[r],c=s.url.replace(/(\?|&)_=[0-9]+/,function(t,e){return"?"===e?e:""}),Offline.getOption("deDupBody")?(e=s.body,e="[object Object]"===e.toString()?JSON.stringify(e):e.toString(),u[s.type.toUpperCase()+" - "+c+" - "+e]=s):u[s.type.toUpperCase()+" - "+c]=s;for(o in u)s=u[o],i(s);return t()}},setTimeout(function(){return Offline.getOption("requests")!==!1?(Offline.on("confirmed-up",function(){return o?(o=!1,t()):void 0}),Offline.on("up",e),Offline.on("down",function(){return o=!1}),Offline.onXHR(function(t){var e,n,i,o,a;return a=t.xhr,i=t.async,a.offline!==!1&&(o=function(){return r(t)},n=a.send,a.send=function(e){return t.body=e,n.apply(a,arguments)},i)?null===a.onprogress?(a.addEventListener("error",o,!1),a.addEventListener("timeout",o,!1)):(e=a.onreadystatechange,a.onreadystatechange=function(){return 0===a.readyState?o():4===a.readyState&&(0===a.status||a.status>=12e3)&&o(),"function"==typeof e?e.apply(null,arguments):void 0}):void 0}),Offline.requests={flush:e,clear:t}):void 0},0)}.call(this),function(){var t,e,n,r,i;if(!Offline)throw new Error("Offline simulate brought in without offline.js");for(r=["up","down"],e=0,n=r.length;n>e;e++)i=r[e],(document.querySelector("script[data-simulate='"+i+"']")||("undefined"!=typeof localStorage&&null!==localStorage?localStorage.OFFLINE_SIMULATE:void 0)===i)&&(null==Offline.options&&(Offline.options={}),null==(t=Offline.options).checks&&(t.checks={}),Offline.options.checks.active=i)}.call(this),function(){var t,e,n,r,i,o,a,s,u,c,f,l,h;if(!window.Offline)throw new Error("Offline UI brought in without offline.js");e='<div class="offline-ui"><div class="offline-ui-content"></div></div>',t='<a href class="offline-ui-retry"></a>',o=function(t){var e;return e=document.createElement("div"),e.innerHTML=t,e.children[0]},a=i=null,r=function(t){return f(t),a.className+=" "+t},f=function(t){return a.className=a.className.replace(new RegExp("(^| )"+t.split(" ").join("|")+"( |$)","gi")," ")},u={},s=function(t,e){return r(t),null!=u[t]&&clearTimeout(u[t]),u[t]=setTimeout(function(){return f(t),delete u[t]},1e3*e)},h=function(t){var e,n,r,i;r={day:86400,hour:3600,minute:60,second:1};for(n in r)if(e=r[n],t>=e)return i=Math.floor(t/e),[i,n];return["now",""]},l=function(){var n,s;return a=o(e),document.body.appendChild(a),null!=Offline.reconnect&&Offline.getOption("reconnect")&&(a.appendChild(o(t)),n=a.querySelector(".offline-ui-retry"),s=function(t){return t.preventDefault(),Offline.reconnect.tryNow()},null!=n.addEventListener?n.addEventListener("click",s,!1):n.attachEvent("click",s)),r("offline-ui-"+Offline.state),i=a.querySelector(".offline-ui-content")},c=function(){return l(),Offline.on("up",function(){return f("offline-ui-down"),r("offline-ui-up"),s("offline-ui-up-2s",2),s("offline-ui-up-5s",5)}),Offline.on("down",function(){return f("offline-ui-up"),r("offline-ui-down"),s("offline-ui-down-2s",2),s("offline-ui-down-5s",5)}),Offline.on("reconnect:connecting",function(){return r("offline-ui-connecting"),f("offline-ui-waiting")}),Offline.on("reconnect:tick",function(){var t,e,n;return r("offline-ui-waiting"),f("offline-ui-connecting"),t=h(Offline.reconnect.remaining),e=t[0],n=t[1],i.setAttribute("data-retry-in-value",e),i.setAttribute("data-retry-in-unit",n)}),Offline.on("reconnect:stopped",function(){return f("offline-ui-connecting offline-ui-waiting"),i.setAttribute("data-retry-in-value",null),i.setAttribute("data-retry-in-unit",null)}),Offline.on("reconnect:failure",function(){return s("offline-ui-reconnect-failed-2s",2),s("offline-ui-reconnect-failed-5s",5)}),Offline.on("reconnect:success",function(){return s("offline-ui-reconnect-succeeded-2s",2),s("offline-ui-reconnect-succeeded-5s",5)})},"complete"===document.readyState?c():null!=document.addEventListener?document.addEventListener("DOMContentLoaded",c,!1):(n=document.onreadystatechange,document.onreadystatechange=function(){return"complete"===document.readyState&&c(),"function"==typeof n?n.apply(null,arguments):void 0})}.call(this),function(){function t(t,e){if(t!==e){var n=null===t,r=t===k,i=t===t,o=null===e,a=e===k,s=e===e;if(t>e&&!o||!i||n&&!a&&s||r&&s)return 1;if(e>t&&!n||!s||o&&!r&&i||a&&i)return-1}return 0}function e(t,e,n){for(var r=t.length,i=n?r:-1;n?i--:++i<r;)if(e(t[i],i,t))return i;return-1}function n(t,e,n){if(e!==e)return p(t,n);for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function r(t){return"function"==typeof t||!1}function i(t){return null==t?"":t+""}function o(t,e){for(var n=-1,r=t.length;++n<r&&e.indexOf(t.charAt(n))>-1;);return n}function a(t,e){for(var n=t.length;n--&&e.indexOf(t.charAt(n))>-1;);return n}function s(e,n){return t(e.criteria,n.criteria)||e.index-n.index}function u(e,n,r){for(var i=-1,o=e.criteria,a=n.criteria,s=o.length,u=r.length;++i<s;){var c=t(o[i],a[i]);if(c){if(i>=u)return c;var f=r[i];return c*("asc"===f||f===!0?1:-1)}}return e.index-n.index}function c(t){return zt[t]}function f(t){return Ft[t]}function l(t,e,n){return e?t=Vt[t]:n&&(t=Xt[t]),"\\"+t}function h(t){return"\\"+Xt[t]}function p(t,e,n){for(var r=t.length,i=e+(n?0:-1);n?i--:++i<r;){var o=t[i];if(o!==o)return i}return-1}function d(t){return!!t&&"object"==typeof t}function _(t){return 160>=t&&t>=9&&13>=t||32==t||160==t||5760==t||6158==t||t>=8192&&(8202>=t||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}function v(t,e){for(var n=-1,r=t.length,i=-1,o=[];++n<r;)t[n]===e&&(t[n]=z,o[++i]=n);return o}function g(t,e){for(var n,r=-1,i=t.length,o=-1,a=[];++r<i;){var s=t[r],u=e?e(s,r,t):s;r&&n===u||(n=u,a[++o]=s)}return a}function y(t){for(var e=-1,n=t.length;++e<n&&_(t.charCodeAt(e)););return e}function m(t){for(var e=t.length;e--&&_(t.charCodeAt(e)););return e}function w(t){return qt[t]}function b(_){function J(t){if(d(t)&&!Rs(t)&&!(t instanceof zt)){if(t instanceof tt)return t;if(ea.call(t,"__chain__")&&ea.call(t,"__wrapped__"))return pr(t)}return new tt(t)}function Q(){}function tt(t,e,n){this.__wrapped__=t,this.__actions__=n||[],this.__chain__=!!e}function zt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=xa,this.__views__=[]}function Ft(){var t=new zt(this.__wrapped__);return t.__actions__=ne(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ne(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ne(this.__views__),t}function qt(){if(this.__filtered__){var t=new zt(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Wt(){var t=this.__wrapped__.value(),e=this.__dir__,n=Rs(t),r=0>e,i=n?t.length:0,o=Xn(0,i,this.__views__),a=o.start,s=o.end,u=s-a,c=r?s:a-1,f=this.__iteratees__,l=f.length,h=0,p=Ea(u,this.__takeCount__);if(!n||N>i||i==u&&p==u)return nn(t,this.__actions__);var d=[];t:for(;u--&&p>h;){c+=e;for(var _=-1,v=t[c];++_<l;){var g=f[_],y=g.iteratee,m=g.type,w=y(v);if(m==H)v=w;else if(!w){if(m==j)continue t;break t}}d[h++]=v}return d}function Vt(){this.__data__={}}function Xt(t){return this.has(t)&&delete this.__data__[t]}function Yt(t){return"__proto__"==t?k:this.__data__[t]}function Jt(t){return"__proto__"!=t&&ea.call(this.__data__,t)}function Zt(t,e){return"__proto__"!=t&&(this.__data__[t]=e),this}function $t(t){var e=t?t.length:0;for(this.data={hash:ga(null),set:new la};e--;)this.push(t[e])}function Gt(t,e){var n=t.data,r="string"==typeof e||Mi(e)?n.set.has(e):n.hash[e];return r?0:-1}function Qt(t){var e=this.data;"string"==typeof t||Mi(t)?e.set.add(t):e.hash[t]=!0}function ee(t,e){for(var n=-1,r=t.length,i=-1,o=e.length,a=zo(r+o);++n<r;)a[n]=t[n];for(;++i<o;)a[n++]=e[i];return a}function ne(t,e){var n=-1,r=t.length;for(e||(e=zo(r));++n<r;)e[n]=t[n];return e}function re(t,e){for(var n=-1,r=t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function ie(t,e){for(var n=t.length;n--&&e(t[n],n,t)!==!1;);return t}function oe(t,e){for(var n=-1,r=t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function ae(t,e,n,r){for(var i=-1,o=t.length,a=r,s=a;++i<o;){var u=t[i],c=+e(u);n(c,a)&&(a=c,s=u)}return s}function se(t,e){for(var n=-1,r=t.length,i=-1,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[++i]=a)}return o}function ue(t,e){for(var n=-1,r=t.length,i=zo(r);++n<r;)i[n]=e(t[n],n,t);return i}function ce(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function fe(t,e,n,r){var i=-1,o=t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n}function le(t,e,n,r){var i=t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function he(t,e){for(var n=-1,r=t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function pe(t,e){for(var n=t.length,r=0;n--;)r+=+e(t[n])||0;return r}function de(t,e){return t===k?e:t}function _e(t,e,n,r){return t!==k&&ea.call(r,n)?t:e}function ve(t,e,n){for(var r=-1,i=Us(e),o=i.length;++r<o;){var a=i[r],s=t[a],u=n(s,e[a],a,t,e);(u===u?u===s:s!==s)&&(s!==k||a in t)||(t[a]=u)}return t}function ge(t,e){return null==e?t:me(e,Us(e),t)}function ye(t,e){for(var n=-1,r=null==t,i=!r&&Gn(t),o=i?t.length:0,a=e.length,s=zo(a);++n<a;){var u=e[n];i?s[n]=Qn(u,o)?t[u]:k:s[n]=r?k:t[u]}return s}function me(t,e,n){n||(n={});for(var r=-1,i=e.length;++r<i;){var o=e[r];n[o]=t[o]}return n}function we(t,e,n){var r=typeof t;return"function"==r?e===k?t:an(t,e,n):null==t?xo:"object"==r?He(t):e===k?Mo(t):Ue(t,e)}function be(t,e,n,r,i,o,a){var s;if(n&&(s=i?n(t,r,i):n(t)),s!==k)return s;if(!Mi(t))return t;var u=Rs(t);if(u){if(s=Yn(t),!e)return ne(t,s)}else{var c=ra.call(t),f=c==Y;if(c!=$&&c!=F&&(!f||i))return Ut[c]?Zn(t,c,e):i?t:{};if(s=Jn(f?{}:t),!e)return ge(s,t)}o||(o=[]),a||(a=[]);for(var l=o.length;l--;)if(o[l]==t)return a[l];return o.push(t),a.push(s),(u?re:Le)(t,function(r,i){s[i]=be(r,e,n,i,t,o,a)}),s}function ke(t,e,n){if("function"!=typeof t)throw new $o(U);return ha(function(){t.apply(k,n)},e)}function Ee(t,e){var r=t?t.length:0,i=[];if(!r)return i;var o=-1,a=qn(),s=a===n,u=s&&e.length>=N?_n(e):null,c=e.length;u&&(a=Gt,s=!1,e=u);t:for(;++o<r;){var f=t[o];if(s&&f===f){for(var l=c;l--;)if(e[l]===f)continue t;i.push(f)}else a(e,f,0)<0&&i.push(f)}return i}function Oe(t,e){var n=!0;return Pa(t,function(t,r,i){return n=!!e(t,r,i)}),n}function Se(t,e,n,r){var i=r,o=i;return Pa(t,function(t,a,s){var u=+e(t,a,s);(n(u,i)||u===r&&u===o)&&(i=u,o=t)}),o}function Te(t,e,n,r){var i=t.length;for(n=null==n?0:+n||0,0>n&&(n=-n>i?0:i+n),r=r===k||r>i?i:+r||0,0>r&&(r+=i),i=n>r?0:r>>>0,n>>>=0;i>n;)t[n++]=e;return t}function Ce(t,e){var n=[];return Pa(t,function(t,r,i){e(t,r,i)&&n.push(t)}),n}function xe(t,e,n,r){var i;return n(t,function(t,n,o){return e(t,n,o)?(i=r?n:t,!1):void 0}),i}function Re(t,e,n,r){r||(r=[]);for(var i=-1,o=t.length;++i<o;){var a=t[i];d(a)&&Gn(a)&&(n||Rs(a)||Si(a))?e?Re(a,e,n,r):ce(r,a):n||(r[r.length]=a)}return r}function Ae(t,e){return ja(t,e,to)}function Le(t,e){return ja(t,e,Us)}function De(t,e){return Ha(t,e,Us)}function Ie(t,e){for(var n=-1,r=e.length,i=-1,o=[];++n<r;){var a=e[n];Ii(t[a])&&(o[++i]=a)}return o}function Me(t,e,n){if(null!=t){n!==k&&n in lr(t)&&(e=[n]);for(var r=0,i=e.length;null!=t&&i>r;)t=t[e[r++]];return r&&r==i?t:k}}function Be(t,e,n,r,i,o){return t===e?!0:null==t||null==e||!Mi(t)&&!d(e)?t!==t&&e!==e:Pe(t,e,Be,n,r,i,o)}function Pe(t,e,n,r,i,o,a){var s=Rs(t),u=Rs(e),c=q,f=q;s||(c=ra.call(t),c==F?c=$:c!=$&&(s=qi(t))),u||(f=ra.call(e),f==F?f=$:f!=$&&(u=qi(e)));var l=c==$,h=f==$,p=c==f;if(p&&!s&&!l)return Hn(t,e,c);if(!i){var d=l&&ea.call(t,"__wrapped__"),_=h&&ea.call(e,"__wrapped__");if(d||_)return n(d?t.value():t,_?e.value():e,r,i,o,a)}if(!p)return!1;o||(o=[]),a||(a=[]);for(var v=o.length;v--;)if(o[v]==t)return a[v]==e;o.push(t),a.push(e);var g=(s?jn:Un)(t,e,n,r,i,o,a);return o.pop(),a.pop(),g}function Ne(t,e,n){var r=e.length,i=r,o=!n;if(null==t)return!i;for(t=lr(t);r--;){var a=e[r];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++r<i;){a=e[r];var s=a[0],u=t[s],c=a[1];if(o&&a[2]){if(u===k&&!(s in t))return!1}else{var f=n?n(u,c,s):k;if(!(f===k?Be(c,u,n,!0):f))return!1}}return!0}function je(t,e){var n=-1,r=Gn(t)?zo(t.length):[];return Pa(t,function(t,i,o){r[++n]=e(t,i,o)}),r}function He(t){var e=Wn(t);if(1==e.length&&e[0][2]){var n=e[0][0],r=e[0][1];return function(t){return null==t?!1:t[n]===r&&(r!==k||n in lr(t))}}return function(t){return Ne(t,e)}}function Ue(t,e){var n=Rs(t),r=tr(t)&&rr(e),i=t+"";return t=hr(t),function(o){if(null==o)return!1;var a=i;if(o=lr(o),(n||!r)&&!(a in o)){if(o=1==t.length?o:Me(o,Je(t,0,-1)),null==o)return!1;a=Tr(t),o=lr(o)}return o[a]===e?e!==k||a in o:Be(e,o[a],k,!0)}}function ze(t,e,n,r,i){if(!Mi(t))return t;var o=Gn(e)&&(Rs(e)||qi(e)),a=o?k:Us(e);return re(a||e,function(s,u){if(a&&(u=s,s=e[u]),d(s))r||(r=[]),i||(i=[]),Fe(t,e,u,ze,n,r,i);else{var c=t[u],f=n?n(c,s,u,t,e):k,l=f===k;l&&(f=s),f===k&&(!o||u in t)||!l&&(f===f?f===c:c!==c)||(t[u]=f)}}),t}function Fe(t,e,n,r,i,o,a){for(var s=o.length,u=e[n];s--;)if(o[s]==u)return void(t[n]=a[s]);var c=t[n],f=i?i(c,u,n,t,e):k,l=f===k;l&&(f=u,Gn(u)&&(Rs(u)||qi(u))?f=Rs(c)?c:Gn(c)?ne(c):[]:Ui(u)||Si(u)?f=Si(c)?Ji(c):Ui(c)?c:{}:l=!1),o.push(u),a.push(f),l?t[n]=r(f,u,i,o,a):(f===f?f!==c:c===c)&&(t[n]=f)}function qe(t){return function(e){return null==e?k:e[t]}}function We(t){var e=t+"";return t=hr(t),function(n){return Me(n,t,e)}}function Ve(t,e){for(var n=t?e.length:0;n--;){var r=e[n];if(r!=i&&Qn(r)){var i=r;pa.call(t,r,1)}}return t}function Xe(t,e){return t+ya(Ta()*(e-t+1))}function Ye(t,e,n,r,i){return i(t,function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)}),n}function Je(t,e,n){var r=-1,i=t.length;e=null==e?0:+e||0,0>e&&(e=-e>i?0:i+e),n=n===k||n>i?i:+n||0,0>n&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=zo(i);++r<i;)o[r]=t[r+e];return o}function Ze(t,e){var n;return Pa(t,function(t,r,i){return n=e(t,r,i),!n}),!!n}function $e(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function Ge(t,e,n){var r=zn(),i=-1;e=ue(e,function(t){return r(t)});var o=je(t,function(t){var n=ue(e,function(e){return e(t)});return{criteria:n,index:++i,value:t}});return $e(o,function(t,e){return u(t,e,n)})}function Qe(t,e){var n=0;return Pa(t,function(t,r,i){n+=+e(t,r,i)||0}),n}function Ke(t,e){var r=-1,i=qn(),o=t.length,a=i===n,s=a&&o>=N,u=s?_n():null,c=[];u?(i=Gt,a=!1):(s=!1,u=e?[]:c);t:for(;++r<o;){var f=t[r],l=e?e(f,r,t):f;if(a&&f===f){for(var h=u.length;h--;)if(u[h]===l)continue t;e&&u.push(l),c.push(f)}else i(u,l,0)<0&&((e||s)&&u.push(l),c.push(f))}return c}function tn(t,e){for(var n=-1,r=e.length,i=zo(r);++n<r;)i[n]=t[e[n]];return i}function en(t,e,n,r){for(var i=t.length,o=r?i:-1;(r?o--:++o<i)&&e(t[o],o,t););return n?Je(t,r?0:o,r?o+1:i):Je(t,r?o+1:0,r?i:o)}function nn(t,e){var n=t;n instanceof zt&&(n=n.value());for(var r=-1,i=e.length;++r<i;){var o=e[r];n=o.func.apply(o.thisArg,ce([n],o.args))}return n}function rn(t,e,n){var r=0,i=t?t.length:r;if("number"==typeof e&&e===e&&La>=i){for(;i>r;){var o=r+i>>>1,a=t[o];(n?e>=a:e>a)&&null!==a?r=o+1:i=o}return i}return on(t,e,xo,n)}function on(t,e,n,r){e=n(e);for(var i=0,o=t?t.length:0,a=e!==e,s=null===e,u=e===k;o>i;){var c=ya((i+o)/2),f=n(t[c]),l=f!==k,h=f===f;if(a)var p=h||r;else p=s?h&&l&&(r||null!=f):u?h&&(r||l):null==f?!1:r?e>=f:e>f;p?i=c+1:o=c}return Ea(o,Aa)}function an(t,e,n){if("function"!=typeof t)return xo;if(e===k)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,i){return t.call(e,n,r,i)};case 4:return function(n,r,i,o){return t.call(e,n,r,i,o)};case 5:return function(n,r,i,o,a){return t.call(e,n,r,i,o,a)}}return function(){return t.apply(e,arguments)}}function sn(t){var e=new aa(t.byteLength),n=new da(e);return n.set(new da(t)),e}function un(t,e,n){for(var r=n.length,i=-1,o=ka(t.length-r,0),a=-1,s=e.length,u=zo(s+o);++a<s;)u[a]=e[a];for(;++i<r;)u[n[i]]=t[i];for(;o--;)u[a++]=t[i++];return u}function cn(t,e,n){for(var r=-1,i=n.length,o=-1,a=ka(t.length-i,0),s=-1,u=e.length,c=zo(a+u);++o<a;)c[o]=t[o];for(var f=o;++s<u;)c[f+s]=e[s];for(;++r<i;)c[f+n[r]]=t[o++];return c}function fn(t,e){return function(n,r,i){var o=e?e():{};if(r=zn(r,i,3),Rs(n))for(var a=-1,s=n.length;++a<s;){var u=n[a];t(o,u,r(u,a,n),n)}else Pa(n,function(e,n,i){t(o,e,r(e,n,i),i)});return o}}function ln(t){return gi(function(e,n){var r=-1,i=null==e?0:n.length,o=i>2?n[i-2]:k,a=i>2?n[2]:k,s=i>1?n[i-1]:k;for("function"==typeof o?(o=an(o,s,5),i-=2):(o="function"==typeof s?s:k,i-=o?1:0),a&&Kn(n[0],n[1],a)&&(o=3>i?k:o,i=1);++r<i;){var u=n[r];u&&t(e,u,o)}return e})}function hn(t,e){return function(n,r){var i=n?Fa(n):0;if(!nr(i))return t(n,r);for(var o=e?i:-1,a=lr(n);(e?o--:++o<i)&&r(a[o],o,a)!==!1;);return n}}function pn(t){return function(e,n,r){for(var i=lr(e),o=r(e),a=o.length,s=t?a:-1;t?s--:++s<a;){var u=o[s];if(n(i[u],u,i)===!1)break}return e}}function dn(t,e){function n(){var i=this&&this!==Kt&&this instanceof n?r:t;return i.apply(e,arguments)}var r=gn(t);return n}function _n(t){return ga&&la?new $t(t):null}function vn(t){return function(e){for(var n=-1,r=So(fo(e)),i=r.length,o="";++n<i;)o=t(o,r[n],n);return o}}function gn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Ba(t.prototype),r=t.apply(n,e);return Mi(r)?r:n}}function yn(t){function e(n,r,i){i&&Kn(n,r,i)&&(r=k);var o=Nn(n,t,k,k,k,k,k,r);return o.placeholder=e.placeholder,o}return e}function mn(t,e){return gi(function(n){var r=n[0];return null==r?r:(n.push(e),t.apply(k,n))})}function wn(t,e){return function(n,r,i){if(i&&Kn(n,r,i)&&(r=k),r=zn(r,i,3),1==r.length){n=Rs(n)?n:fr(n);var o=ae(n,r,t,e);if(!n.length||o!==e)return o}return Se(n,r,t,e)}}function bn(t,n){return function(r,i,o){if(i=zn(i,o,3),Rs(r)){var a=e(r,i,n);return a>-1?r[a]:k}return xe(r,i,t)}}function kn(t){return function(n,r,i){return n&&n.length?(r=zn(r,i,3),e(n,r,t)):-1}}function En(t){return function(e,n,r){return n=zn(n,r,3),xe(e,n,t,!0)}}function On(t){return function(){for(var e,n=arguments.length,r=t?n:-1,i=0,o=zo(n);t?r--:++r<n;){var a=o[i++]=arguments[r];if("function"!=typeof a)throw new $o(U);!e&&tt.prototype.thru&&"wrapper"==Fn(a)&&(e=new tt([],!0))}for(r=e?-1:n;++r<n;){a=o[r];var s=Fn(a),u="wrapper"==s?za(a):k;e=u&&er(u[0])&&u[1]==(L|C|R|D)&&!u[4].length&&1==u[9]?e[Fn(u[0])].apply(e,u[3]):1==a.length&&er(a)?e[s]():e.thru(a)}return function(){var t=arguments,r=t[0];if(e&&1==t.length&&Rs(r)&&r.length>=N)return e.plant(r).value();for(var i=0,a=n?o[i].apply(this,t):r;++i<n;)a=o[i].call(this,a);return a}}}function Sn(t,e){return function(n,r,i){return"function"==typeof r&&i===k&&Rs(n)?t(n,r):e(n,an(r,i,3))}}function Tn(t){return function(e,n,r){return"function"==typeof n&&r===k||(n=an(n,r,3)),t(e,n,to)}}function Cn(t){return function(e,n,r){return"function"==typeof n&&r===k||(n=an(n,r,3)),t(e,n)}}function xn(t){return function(e,n,r){var i={};return n=zn(n,r,3),Le(e,function(e,r,o){var a=n(e,r,o);r=t?a:r,e=t?e:a,i[r]=e}),i}}function Rn(t){return function(e,n,r){return e=i(e),(t?e:"")+In(e,n,r)+(t?"":e)}}function An(t){var e=gi(function(n,r){var i=v(r,e.placeholder);return Nn(n,t,k,r,i)});return e}function Ln(t,e){return function(n,r,i,o){var a=arguments.length<3;return"function"==typeof r&&o===k&&Rs(n)?t(n,r,i,a):Ye(n,zn(r,o,4),i,a,e);
}}function Dn(t,e,n,r,i,o,a,s,u,c){function f(){for(var m=arguments.length,w=m,b=zo(m);w--;)b[w]=arguments[w];if(r&&(b=un(b,r,i)),o&&(b=cn(b,o,a)),d||g){var E=f.placeholder,T=v(b,E);if(m-=T.length,c>m){var C=s?ne(s):k,x=ka(c-m,0),L=d?T:k,D=d?k:T,I=d?b:k,M=d?k:b;e|=d?R:A,e&=~(d?A:R),_||(e&=~(O|S));var B=[t,e,n,I,L,M,D,C,u,x],P=Dn.apply(k,B);return er(t)&&qa(P,B),P.placeholder=E,P}}var N=h?n:this,j=p?N[t]:t;return s&&(b=ur(b,s)),l&&u<b.length&&(b.length=u),this&&this!==Kt&&this instanceof f&&(j=y||gn(t)),j.apply(N,b)}var l=e&L,h=e&O,p=e&S,d=e&C,_=e&T,g=e&x,y=p?k:gn(t);return f}function In(t,e,n){var r=t.length;if(e=+e,r>=e||!wa(e))return"";var i=e-r;return n=null==n?" ":n+"",go(n,va(i/n.length)).slice(0,i)}function Mn(t,e,n,r){function i(){for(var e=-1,s=arguments.length,u=-1,c=r.length,f=zo(c+s);++u<c;)f[u]=r[u];for(;s--;)f[u++]=arguments[++e];var l=this&&this!==Kt&&this instanceof i?a:t;return l.apply(o?n:this,f)}var o=e&O,a=gn(t);return i}function Bn(t){var e=Vo[t];return function(t,n){return n=n===k?0:+n||0,n?(n=ca(10,n),e(t*n)/n):e(t)}}function Pn(t){return function(e,n,r,i){var o=zn(r);return null==r&&o===we?rn(e,n,t):on(e,n,o(r,i,1),t)}}function Nn(t,e,n,r,i,o,a,s){var u=e&S;if(!u&&"function"!=typeof t)throw new $o(U);var c=r?r.length:0;if(c||(e&=~(R|A),r=i=k),c-=i?i.length:0,e&A){var f=r,l=i;r=i=k}var h=u?k:za(t),p=[t,e,n,r,i,f,l,o,a,s];if(h&&(ir(p,h),e=p[1],s=p[9]),p[9]=null==s?u?0:t.length:ka(s-c,0)||0,e==O)var d=dn(p[0],p[2]);else d=e!=R&&e!=(O|R)||p[4].length?Dn.apply(k,p):Mn.apply(k,p);var _=h?Ua:qa;return _(d,p)}function jn(t,e,n,r,i,o,a){var s=-1,u=t.length,c=e.length;if(u!=c&&!(i&&c>u))return!1;for(;++s<u;){var f=t[s],l=e[s],h=r?r(i?l:f,i?f:l,s):k;if(h!==k){if(h)continue;return!1}if(i){if(!he(e,function(t){return f===t||n(f,t,r,i,o,a)}))return!1}else if(f!==l&&!n(f,l,r,i,o,a))return!1}return!0}function Hn(t,e,n){switch(n){case W:case V:return+t==+e;case X:return t.name==e.name&&t.message==e.message;case Z:return t!=+t?e!=+e:t==+e;case G:case K:return t==e+""}return!1}function Un(t,e,n,r,i,o,a){var s=Us(t),u=s.length,c=Us(e),f=c.length;if(u!=f&&!i)return!1;for(var l=u;l--;){var h=s[l];if(!(i?h in e:ea.call(e,h)))return!1}for(var p=i;++l<u;){h=s[l];var d=t[h],_=e[h],v=r?r(i?_:d,i?d:_,h):k;if(!(v===k?n(d,_,r,i,o,a):v))return!1;p||(p="constructor"==h)}if(!p){var g=t.constructor,y=e.constructor;if(g!=y&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y))return!1}return!0}function zn(t,e,n){var r=J.callback||To;return r=r===To?we:r,n?r(t,e,n):r}function Fn(t){for(var e=t.name+"",n=Ma[e],r=n?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function qn(t,e,r){var i=J.indexOf||Or;return i=i===Or?n:i,t?i(t,e,r):i}function Wn(t){for(var e=eo(t),n=e.length;n--;)e[n][2]=rr(e[n][1]);return e}function Vn(t,e){var n=null==t?k:t[e];return Ni(n)?n:k}function Xn(t,e,n){for(var r=-1,i=n.length;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Ea(e,t+a);break;case"takeRight":t=ka(t,e-a)}}return{start:t,end:e}}function Yn(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ea.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Jn(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Yo),new e}function Zn(t,e,n){var r=t.constructor;switch(e){case et:return sn(t);case W:case V:return new r(+t);case nt:case rt:case it:case ot:case at:case st:case ut:case ct:case ft:var i=t.buffer;return new r(n?sn(i):i,t.byteOffset,t.length);case Z:case K:return new r(t);case G:var o=new r(t.source,Rt.exec(t));o.lastIndex=t.lastIndex}return o}function $n(t,e,n){null==t||tr(e,t)||(e=hr(e),t=1==e.length?t:Me(t,Je(e,0,-1)),e=Tr(e));var r=null==t?t:t[e];return null==r?k:r.apply(t,n)}function Gn(t){return null!=t&&nr(Fa(t))}function Qn(t,e){return t="number"==typeof t||Dt.test(t)?+t:-1,e=null==e?Da:e,t>-1&&t%1==0&&e>t}function Kn(t,e,n){if(!Mi(n))return!1;var r=typeof e;if("number"==r?Gn(n)&&Qn(e,n.length):"string"==r&&e in n){var i=n[e];return t===t?t===i:i!==i}return!1}function tr(t,e){var n=typeof t;if("string"==n&&kt.test(t)||"number"==n)return!0;if(Rs(t))return!1;var r=!bt.test(t);return r||null!=e&&t in lr(e)}function er(t){var e=Fn(t),n=J[e];if("function"!=typeof n||!(e in zt.prototype))return!1;if(t===n)return!0;var r=za(n);return!!r&&t===r[0]}function nr(t){return"number"==typeof t&&t>-1&&t%1==0&&Da>=t}function rr(t){return t===t&&!Mi(t)}function ir(t,e){var n=t[1],r=e[1],i=n|r,o=L>i,a=r==L&&n==C||r==L&&n==D&&t[7].length<=e[8]||r==(L|D)&&n==C;if(!o&&!a)return t;r&O&&(t[2]=e[2],i|=n&O?0:T);var s=e[3];if(s){var u=t[3];t[3]=u?un(u,s,e[4]):ne(s),t[4]=u?v(t[3],z):ne(e[4])}return s=e[5],s&&(u=t[5],t[5]=u?cn(u,s,e[6]):ne(s),t[6]=u?v(t[5],z):ne(e[6])),s=e[7],s&&(t[7]=ne(s)),r&L&&(t[8]=null==t[8]?e[8]:Ea(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t}function or(t,e){return t===k?e:As(t,e,or)}function ar(t,e){t=lr(t);for(var n=-1,r=e.length,i={};++n<r;){var o=e[n];o in t&&(i[o]=t[o])}return i}function sr(t,e){var n={};return Ae(t,function(t,r,i){e(t,r,i)&&(n[r]=t)}),n}function ur(t,e){for(var n=t.length,r=Ea(e.length,n),i=ne(t);r--;){var o=e[r];t[r]=Qn(o,n)?i[o]:k}return t}function cr(t){for(var e=to(t),n=e.length,r=n&&t.length,i=!!r&&nr(r)&&(Rs(t)||Si(t)),o=-1,a=[];++o<n;){var s=e[o];(i&&Qn(s,r)||ea.call(t,s))&&a.push(s)}return a}function fr(t){return null==t?[]:Gn(t)?Mi(t)?t:Yo(t):oo(t)}function lr(t){return Mi(t)?t:Yo(t)}function hr(t){if(Rs(t))return t;var e=[];return i(t).replace(Et,function(t,n,r,i){e.push(r?i.replace(Ct,"$1"):n||t)}),e}function pr(t){return t instanceof zt?t.clone():new tt(t.__wrapped__,t.__chain__,ne(t.__actions__))}function dr(t,e,n){e=(n?Kn(t,e,n):null==e)?1:ka(ya(e)||1,1);for(var r=0,i=t?t.length:0,o=-1,a=zo(va(i/e));i>r;)a[++o]=Je(t,r,r+=e);return a}function _r(t){for(var e=-1,n=t?t.length:0,r=-1,i=[];++e<n;){var o=t[e];o&&(i[++r]=o)}return i}function vr(t,e,n){var r=t?t.length:0;return r?((n?Kn(t,e,n):null==e)&&(e=1),Je(t,0>e?0:e)):[]}function gr(t,e,n){var r=t?t.length:0;return r?((n?Kn(t,e,n):null==e)&&(e=1),e=r-(+e||0),Je(t,0,0>e?0:e)):[]}function yr(t,e,n){return t&&t.length?en(t,zn(e,n,3),!0,!0):[]}function mr(t,e,n){return t&&t.length?en(t,zn(e,n,3),!0):[]}function wr(t,e,n,r){var i=t?t.length:0;return i?(n&&"number"!=typeof n&&Kn(t,e,n)&&(n=0,r=i),Te(t,e,n,r)):[]}function br(t){return t?t[0]:k}function kr(t,e,n){var r=t?t.length:0;return n&&Kn(t,e,n)&&(e=!1),r?Re(t,e):[]}function Er(t){var e=t?t.length:0;return e?Re(t,!0):[]}function Or(t,e,r){var i=t?t.length:0;if(!i)return-1;if("number"==typeof r)r=0>r?ka(i+r,0):r;else if(r){var o=rn(t,e);return i>o&&(e===e?e===t[o]:t[o]!==t[o])?o:-1}return n(t,e,r||0)}function Sr(t){return gr(t,1)}function Tr(t){var e=t?t.length:0;return e?t[e-1]:k}function Cr(t,e,n){var r=t?t.length:0;if(!r)return-1;var i=r;if("number"==typeof n)i=(0>n?ka(r+n,0):Ea(n||0,r-1))+1;else if(n){i=rn(t,e,!0)-1;var o=t[i];return(e===e?e===o:o!==o)?i:-1}if(e!==e)return p(t,i,!0);for(;i--;)if(t[i]===e)return i;return-1}function xr(){var t=arguments,e=t[0];if(!e||!e.length)return e;for(var n=0,r=qn(),i=t.length;++n<i;)for(var o=0,a=t[n];(o=r(e,a,o))>-1;)pa.call(e,o,1);return e}function Rr(t,e,n){var r=[];if(!t||!t.length)return r;var i=-1,o=[],a=t.length;for(e=zn(e,n,3);++i<a;){var s=t[i];e(s,i,t)&&(r.push(s),o.push(i))}return Ve(t,o),r}function Ar(t){return vr(t,1)}function Lr(t,e,n){var r=t?t.length:0;return r?(n&&"number"!=typeof n&&Kn(t,e,n)&&(e=0,n=r),Je(t,e,n)):[]}function Dr(t,e,n){var r=t?t.length:0;return r?((n?Kn(t,e,n):null==e)&&(e=1),Je(t,0,0>e?0:e)):[]}function Ir(t,e,n){var r=t?t.length:0;return r?((n?Kn(t,e,n):null==e)&&(e=1),e=r-(+e||0),Je(t,0>e?0:e)):[]}function Mr(t,e,n){return t&&t.length?en(t,zn(e,n,3),!1,!0):[]}function Br(t,e,n){return t&&t.length?en(t,zn(e,n,3)):[]}function Pr(t,e,r,i){var o=t?t.length:0;if(!o)return[];null!=e&&"boolean"!=typeof e&&(i=r,r=Kn(t,e,i)?k:e,e=!1);var a=zn();return null==r&&a===we||(r=a(r,i,3)),e&&qn()===n?g(t,r):Ke(t,r)}function Nr(t){if(!t||!t.length)return[];var e=-1,n=0;t=se(t,function(t){return Gn(t)?(n=ka(t.length,n),!0):void 0});for(var r=zo(n);++e<n;)r[e]=ue(t,qe(e));return r}function jr(t,e,n){var r=t?t.length:0;if(!r)return[];var i=Nr(t);return null==e?i:(e=an(e,n,4),ue(i,function(t){return fe(t,e,k,!0)}))}function Hr(){for(var t=-1,e=arguments.length;++t<e;){var n=arguments[t];if(Gn(n))var r=r?ce(Ee(r,n),Ee(n,r)):n}return r?Ke(r):[]}function Ur(t,e){var n=-1,r=t?t.length:0,i={};for(!r||e||Rs(t[0])||(e=[]);++n<r;){var o=t[n];e?i[o]=e[n]:o&&(i[o[0]]=o[1])}return i}function zr(t){var e=J(t);return e.__chain__=!0,e}function Fr(t,e,n){return e.call(n,t),t}function qr(t,e,n){return e.call(n,t)}function Wr(){return zr(this)}function Vr(){return new tt(this.value(),this.__chain__)}function Xr(t){for(var e,n=this;n instanceof Q;){var r=pr(n);e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e}function Yr(){var t=this.__wrapped__,e=function(t){return t.reverse()};if(t instanceof zt){var n=t;return this.__actions__.length&&(n=new zt(this)),n=n.reverse(),n.__actions__.push({func:qr,args:[e],thisArg:k}),new tt(n,this.__chain__)}return this.thru(e)}function Jr(){return this.value()+""}function Zr(){return nn(this.__wrapped__,this.__actions__)}function $r(t,e,n){var r=Rs(t)?oe:Oe;return n&&Kn(t,e,n)&&(e=k),"function"==typeof e&&n===k||(e=zn(e,n,3)),r(t,e)}function Gr(t,e,n){var r=Rs(t)?se:Ce;return e=zn(e,n,3),r(t,e)}function Qr(t,e){return is(t,He(e))}function Kr(t,e,n,r){var i=t?Fa(t):0;return nr(i)||(t=oo(t),i=t.length),n="number"!=typeof n||r&&Kn(e,n,r)?0:0>n?ka(i+n,0):n||0,"string"==typeof t||!Rs(t)&&Fi(t)?i>=n&&t.indexOf(e,n)>-1:!!i&&qn(t,e,n)>-1}function ti(t,e,n){var r=Rs(t)?ue:je;return e=zn(e,n,3),r(t,e)}function ei(t,e){return ti(t,Mo(e))}function ni(t,e,n){var r=Rs(t)?se:Ce;return e=zn(e,n,3),r(t,function(t,n,r){return!e(t,n,r)})}function ri(t,e,n){if(n?Kn(t,e,n):null==e){t=fr(t);var r=t.length;return r>0?t[Xe(0,r-1)]:k}var i=-1,o=Yi(t),r=o.length,a=r-1;for(e=Ea(0>e?0:+e||0,r);++i<e;){var s=Xe(i,a),u=o[s];o[s]=o[i],o[i]=u}return o.length=e,o}function ii(t){return ri(t,xa)}function oi(t){var e=t?Fa(t):0;return nr(e)?e:Us(t).length}function ai(t,e,n){var r=Rs(t)?he:Ze;return n&&Kn(t,e,n)&&(e=k),"function"==typeof e&&n===k||(e=zn(e,n,3)),r(t,e)}function si(t,e,n){if(null==t)return[];n&&Kn(t,e,n)&&(e=k);var r=-1;e=zn(e,n,3);var i=je(t,function(t,n,i){return{criteria:e(t,n,i),index:++r,value:t}});return $e(i,s)}function ui(t,e,n,r){return null==t?[]:(r&&Kn(e,n,r)&&(n=k),Rs(e)||(e=null==e?[]:[e]),Rs(n)||(n=null==n?[]:[n]),Ge(t,e,n))}function ci(t,e){return Gr(t,He(e))}function fi(t,e){if("function"!=typeof e){if("function"!=typeof t)throw new $o(U);var n=t;t=e,e=n}return t=wa(t=+t)?t:0,function(){return--t<1?e.apply(this,arguments):void 0}}function li(t,e,n){return n&&Kn(t,e,n)&&(e=k),e=t&&null==e?t.length:ka(+e||0,0),Nn(t,L,k,k,k,k,e)}function hi(t,e){var n;if("function"!=typeof e){if("function"!=typeof t)throw new $o(U);var r=t;t=e,e=r}return function(){return--t>0&&(n=e.apply(this,arguments)),1>=t&&(e=k),n}}function pi(t,e,n){function r(){p&&sa(p),c&&sa(c),_=0,c=p=d=k}function i(e,n){n&&sa(n),c=p=d=k,e&&(_=_s(),f=t.apply(h,u),p||c||(u=h=k))}function o(){var t=e-(_s()-l);0>=t||t>e?i(d,c):p=ha(o,t)}function a(){i(g,p)}function s(){if(u=arguments,l=_s(),h=this,d=g&&(p||!y),v===!1)var n=y&&!p;else{c||y||(_=l);var r=v-(l-_),i=0>=r||r>v;i?(c&&(c=sa(c)),_=l,f=t.apply(h,u)):c||(c=ha(a,r))}return i&&p?p=sa(p):p||e===v||(p=ha(o,e)),n&&(i=!0,f=t.apply(h,u)),!i||p||c||(u=h=k),f}var u,c,f,l,h,p,d,_=0,v=!1,g=!0;if("function"!=typeof t)throw new $o(U);if(e=0>e?0:+e||0,n===!0){var y=!0;g=!1}else Mi(n)&&(y=!!n.leading,v="maxWait"in n&&ka(+n.maxWait||0,e),g="trailing"in n?!!n.trailing:g);return s.cancel=r,s}function di(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new $o(U);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a),a};return n.cache=new di.Cache,n}function _i(t){if("function"!=typeof t)throw new $o(U);return function(){return!t.apply(this,arguments)}}function vi(t){return hi(2,t)}function gi(t,e){if("function"!=typeof t)throw new $o(U);return e=ka(e===k?t.length-1:+e||0,0),function(){for(var n=arguments,r=-1,i=ka(n.length-e,0),o=zo(i);++r<i;)o[r]=n[e+r];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,n[0],o);case 2:return t.call(this,n[0],n[1],o)}var a=zo(e+1);for(r=-1;++r<e;)a[r]=n[r];return a[e]=o,t.apply(this,a)}}function yi(t){if("function"!=typeof t)throw new $o(U);return function(e){return t.apply(this,e)}}function mi(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new $o(U);return n===!1?r=!1:Mi(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),pi(t,e,{leading:r,maxWait:+e,trailing:i})}function wi(t,e){return e=null==e?xo:e,Nn(e,R,k,[t],[])}function bi(t,e,n,r){return e&&"boolean"!=typeof e&&Kn(t,e,n)?e=!1:"function"==typeof e&&(r=n,n=e,e=!1),"function"==typeof n?be(t,e,an(n,r,3)):be(t,e)}function ki(t,e,n){return"function"==typeof e?be(t,!0,an(e,n,3)):be(t,!0)}function Ei(t,e){return t>e}function Oi(t,e){return t>=e}function Si(t){return d(t)&&Gn(t)&&ea.call(t,"callee")&&!fa.call(t,"callee")}function Ti(t){return t===!0||t===!1||d(t)&&ra.call(t)==W}function Ci(t){return d(t)&&ra.call(t)==V}function xi(t){return!!t&&1===t.nodeType&&d(t)&&!Ui(t)}function Ri(t){return null==t?!0:Gn(t)&&(Rs(t)||Fi(t)||Si(t)||d(t)&&Ii(t.splice))?!t.length:!Us(t).length}function Ai(t,e,n,r){n="function"==typeof n?an(n,r,3):k;var i=n?n(t,e):k;return i===k?Be(t,e,n):!!i}function Li(t){return d(t)&&"string"==typeof t.message&&ra.call(t)==X}function Di(t){return"number"==typeof t&&wa(t)}function Ii(t){return Mi(t)&&ra.call(t)==Y}function Mi(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Bi(t,e,n,r){return n="function"==typeof n?an(n,r,3):k,Ne(t,Wn(e),n)}function Pi(t){return Hi(t)&&t!=+t}function Ni(t){return null==t?!1:Ii(t)?oa.test(ta.call(t)):d(t)&&Lt.test(t)}function ji(t){return null===t}function Hi(t){return"number"==typeof t||d(t)&&ra.call(t)==Z}function Ui(t){var e;if(!d(t)||ra.call(t)!=$||Si(t)||!ea.call(t,"constructor")&&(e=t.constructor,"function"==typeof e&&!(e instanceof e)))return!1;var n;return Ae(t,function(t,e){n=e}),n===k||ea.call(t,n)}function zi(t){return Mi(t)&&ra.call(t)==G}function Fi(t){return"string"==typeof t||d(t)&&ra.call(t)==K}function qi(t){return d(t)&&nr(t.length)&&!!Ht[ra.call(t)]}function Wi(t){return t===k}function Vi(t,e){return e>t}function Xi(t,e){return e>=t}function Yi(t){var e=t?Fa(t):0;return nr(e)?e?ne(t):[]:oo(t)}function Ji(t){return me(t,to(t))}function Zi(t,e,n){var r=Ba(t);return n&&Kn(t,e,n)&&(e=k),e?ge(r,e):r}function $i(t){return Ie(t,to(t))}function Gi(t,e,n){var r=null==t?k:Me(t,hr(e),e+"");return r===k?n:r}function Qi(t,e){if(null==t)return!1;var n=ea.call(t,e);if(!n&&!tr(e)){if(e=hr(e),t=1==e.length?t:Me(t,Je(e,0,-1)),null==t)return!1;e=Tr(e),n=ea.call(t,e)}return n||nr(t.length)&&Qn(e,t.length)&&(Rs(t)||Si(t))}function Ki(t,e,n){n&&Kn(t,e,n)&&(e=k);for(var r=-1,i=Us(t),o=i.length,a={};++r<o;){var s=i[r],u=t[s];e?ea.call(a,u)?a[u].push(s):a[u]=[s]:a[u]=s}return a}function to(t){if(null==t)return[];Mi(t)||(t=Yo(t));var e=t.length;e=e&&nr(e)&&(Rs(t)||Si(t))&&e||0;for(var n=t.constructor,r=-1,i="function"==typeof n&&n.prototype===t,o=zo(e),a=e>0;++r<e;)o[r]=r+"";for(var s in t)a&&Qn(s,e)||"constructor"==s&&(i||!ea.call(t,s))||o.push(s);return o}function eo(t){t=lr(t);for(var e=-1,n=Us(t),r=n.length,i=zo(r);++e<r;){var o=n[e];i[e]=[o,t[o]]}return i}function no(t,e,n){var r=null==t?k:t[e];return r===k&&(null==t||tr(e,t)||(e=hr(e),t=1==e.length?t:Me(t,Je(e,0,-1)),r=null==t?k:t[Tr(e)]),r=r===k?n:r),Ii(r)?r.call(t):r}function ro(t,e,n){if(null==t)return t;var r=e+"";e=null!=t[r]||tr(e,t)?[r]:hr(e);for(var i=-1,o=e.length,a=o-1,s=t;null!=s&&++i<o;){var u=e[i];Mi(s)&&(i==a?s[u]=n:null==s[u]&&(s[u]=Qn(e[i+1])?[]:{})),s=s[u]}return t}function io(t,e,n,r){var i=Rs(t)||qi(t);if(e=zn(e,r,4),null==n)if(i||Mi(t)){var o=t.constructor;n=i?Rs(t)?new o:[]:Ba(Ii(o)?o.prototype:k)}else n={};return(i?re:Le)(t,function(t,r,i){return e(n,t,r,i)}),n}function oo(t){return tn(t,Us(t))}function ao(t){return tn(t,to(t))}function so(t,e,n){return e=+e||0,n===k?(n=e,e=0):n=+n||0,t>=Ea(e,n)&&t<ka(e,n)}function uo(t,e,n){n&&Kn(t,e,n)&&(e=n=k);var r=null==t,i=null==e;if(null==n&&(i&&"boolean"==typeof t?(n=t,t=1):"boolean"==typeof e&&(n=e,i=!0)),r&&i&&(e=1,i=!1),t=+t||0,i?(e=t,t=0):e=+e||0,n||t%1||e%1){var o=Ta();return Ea(t+o*(e-t+ua("1e-"+((o+"").length-1))),e)}return Xe(t,e)}function co(t){return t=i(t),t&&t.charAt(0).toUpperCase()+t.slice(1)}function fo(t){return t=i(t),t&&t.replace(It,c).replace(Tt,"")}function lo(t,e,n){t=i(t),e+="";var r=t.length;return n=n===k?r:Ea(0>n?0:+n||0,r),n-=e.length,n>=0&&t.indexOf(e,n)==n}function ho(t){return t=i(t),t&&gt.test(t)?t.replace(_t,f):t}function po(t){return t=i(t),t&&St.test(t)?t.replace(Ot,l):t||"(?:)"}function _o(t,e,n){t=i(t),e=+e;var r=t.length;if(r>=e||!wa(e))return t;var o=(e-r)/2,a=ya(o),s=va(o);return n=In("",s,n),n.slice(0,a)+t+n}function vo(t,e,n){return(n?Kn(t,e,n):null==e)?e=0:e&&(e=+e),t=wo(t),Sa(t,e||(At.test(t)?16:10))}function go(t,e){var n="";if(t=i(t),e=+e,1>e||!t||!wa(e))return n;do e%2&&(n+=t),e=ya(e/2),t+=t;while(e);return n}function yo(t,e,n){return t=i(t),n=null==n?0:Ea(0>n?0:+n||0,t.length),t.lastIndexOf(e,n)==n}function mo(t,e,n){var r=J.templateSettings;n&&Kn(t,e,n)&&(e=n=k),t=i(t),e=ve(ge({},n||e),r,_e);var o,a,s=ve(ge({},e.imports),r.imports,_e),u=Us(s),c=tn(s,u),f=0,l=e.interpolate||Mt,p="__p += '",d=Jo((e.escape||Mt).source+"|"+l.source+"|"+(l===wt?xt:Mt).source+"|"+(e.evaluate||Mt).source+"|$","g"),_="//# sourceURL="+("sourceURL"in e?e.sourceURL:"lodash.templateSources["+ ++jt+"]")+"\n";t.replace(d,function(e,n,r,i,s,u){return r||(r=i),p+=t.slice(f,u).replace(Bt,h),n&&(o=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),f=u+e.length,e}),p+="';\n";var v=e.variable;v||(p="with (obj) {\n"+p+"\n}\n"),p=(a?p.replace(lt,""):p).replace(ht,"$1").replace(pt,"$1;"),p="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Gs(function(){return Wo(u,_+"return "+p).apply(k,c)});if(g.source=p,Li(g))throw g;return g}function wo(t,e,n){var r=t;return(t=i(t))?(n?Kn(r,e,n):null==e)?t.slice(y(t),m(t)+1):(e+="",t.slice(o(t,e),a(t,e)+1)):t}function bo(t,e,n){var r=t;return t=i(t),t?(n?Kn(r,e,n):null==e)?t.slice(y(t)):t.slice(o(t,e+"")):t}function ko(t,e,n){var r=t;return t=i(t),t?(n?Kn(r,e,n):null==e)?t.slice(0,m(t)+1):t.slice(0,a(t,e+"")+1):t}function Eo(t,e,n){n&&Kn(t,e,n)&&(e=k);var r=I,o=M;if(null!=e)if(Mi(e)){var a="separator"in e?e.separator:a;r="length"in e?+e.length||0:r,o="omission"in e?i(e.omission):o}else r=+e||0;if(t=i(t),r>=t.length)return t;var s=r-o.length;if(1>s)return o;var u=t.slice(0,s);if(null==a)return u+o;if(zi(a)){if(t.slice(s).search(a)){var c,f,l=t.slice(0,s);for(a.global||(a=Jo(a.source,(Rt.exec(a)||"")+"g")),a.lastIndex=0;c=a.exec(l);)f=c.index;u=u.slice(0,null==f?s:f)}}else if(t.indexOf(a,s)!=s){var h=u.lastIndexOf(a);h>-1&&(u=u.slice(0,h))}return u+o}function Oo(t){return t=i(t),t&&vt.test(t)?t.replace(dt,w):t}function So(t,e,n){return n&&Kn(t,e,n)&&(e=k),t=i(t),t.match(e||Pt)||[]}function To(t,e,n){return n&&Kn(t,e,n)&&(e=k),d(t)?Ro(t):we(t,e)}function Co(t){return function(){return t}}function xo(t){return t}function Ro(t){return He(be(t,!0))}function Ao(t,e){return Ue(t,be(e,!0))}function Lo(t,e,n){if(null==n){var r=Mi(e),i=r?Us(e):k,o=i&&i.length?Ie(e,i):k;(o?o.length:r)||(o=!1,n=e,e=t,t=this)}o||(o=Ie(e,Us(e)));var a=!0,s=-1,u=Ii(t),c=o.length;n===!1?a=!1:Mi(n)&&"chain"in n&&(a=n.chain);for(;++s<c;){var f=o[s],l=e[f];t[f]=l,u&&(t.prototype[f]=function(e){return function(){var n=this.__chain__;if(a||n){var r=t(this.__wrapped__),i=r.__actions__=ne(this.__actions__);return i.push({func:e,args:arguments,thisArg:t}),r.__chain__=n,r}return e.apply(t,ce([this.value()],arguments))}}(l))}return t}function Do(){return Kt._=ia,this}function Io(){}function Mo(t){return tr(t)?qe(t):We(t)}function Bo(t){return function(e){return Me(t,hr(e),e+"")}}function Po(t,e,n){n&&Kn(t,e,n)&&(e=n=k),t=+t||0,n=null==n?1:+n||0,null==e?(e=t,t=0):e=+e||0;for(var r=-1,i=ka(va((e-t)/(n||1)),0),o=zo(i);++r<i;)o[r]=t,t+=n;return o}function No(t,e,n){if(t=ya(t),1>t||!wa(t))return[];var r=-1,i=zo(Ea(t,Ra));for(e=an(e,n,1);++r<t;)Ra>r?i[r]=e(r):e(r);return i}function jo(t){var e=++na;return i(t)+e}function Ho(t,e){return(+t||0)+(+e||0)}function Uo(t,e,n){return n&&Kn(t,e,n)&&(e=k),e=zn(e,n,3),1==e.length?pe(Rs(t)?t:fr(t),e):Qe(t,e)}_=_?te.defaults(Kt.Object(),_,te.pick(Kt,Nt)):Kt;var zo=_.Array,Fo=_.Date,qo=_.Error,Wo=_.Function,Vo=_.Math,Xo=_.Number,Yo=_.Object,Jo=_.RegExp,Zo=_.String,$o=_.TypeError,Go=zo.prototype,Qo=Yo.prototype,Ko=Zo.prototype,ta=Wo.prototype.toString,ea=Qo.hasOwnProperty,na=0,ra=Qo.toString,ia=Kt._,oa=Jo("^"+ta.call(ea).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),aa=_.ArrayBuffer,sa=_.clearTimeout,ua=_.parseFloat,ca=Vo.pow,fa=Qo.propertyIsEnumerable,la=Vn(_,"Set"),ha=_.setTimeout,pa=Go.splice,da=_.Uint8Array,_a=Vn(_,"WeakMap"),va=Vo.ceil,ga=Vn(Yo,"create"),ya=Vo.floor,ma=Vn(zo,"isArray"),wa=_.isFinite,ba=Vn(Yo,"keys"),ka=Vo.max,Ea=Vo.min,Oa=Vn(Fo,"now"),Sa=_.parseInt,Ta=Vo.random,Ca=Xo.NEGATIVE_INFINITY,xa=Xo.POSITIVE_INFINITY,Ra=4294967295,Aa=Ra-1,La=Ra>>>1,Da=9007199254740991,Ia=_a&&new _a,Ma={};J.support={};J.templateSettings={escape:yt,evaluate:mt,interpolate:wt,variable:"",imports:{_:J}};var Ba=function(){function t(){}return function(e){if(Mi(e)){t.prototype=e;var n=new t;t.prototype=k}return n||{}}}(),Pa=hn(Le),Na=hn(De,!0),ja=pn(),Ha=pn(!0),Ua=Ia?function(t,e){return Ia.set(t,e),t}:xo,za=Ia?function(t){return Ia.get(t)}:Io,Fa=qe("length"),qa=function(){var t=0,e=0;return function(n,r){var i=_s(),o=P-(i-e);if(e=i,o>0){if(++t>=B)return n}else t=0;return Ua(n,r)}}(),Wa=gi(function(t,e){return d(t)&&Gn(t)?Ee(t,Re(e,!1,!0)):[]}),Va=kn(),Xa=kn(!0),Ya=gi(function(t){for(var e=t.length,r=e,i=zo(l),o=qn(),a=o===n,s=[];r--;){var u=t[r]=Gn(u=t[r])?u:[];i[r]=a&&u.length>=120?_n(r&&u):null}var c=t[0],f=-1,l=c?c.length:0,h=i[0];t:for(;++f<l;)if(u=c[f],(h?Gt(h,u):o(s,u,0))<0){for(var r=e;--r;){var p=i[r];if((p?Gt(p,u):o(t[r],u,0))<0)continue t}h&&h.push(u),s.push(u)}return s}),Ja=gi(function(e,n){n=Re(n);var r=ye(e,n);return Ve(e,n.sort(t)),r}),Za=Pn(),$a=Pn(!0),Ga=gi(function(t){return Ke(Re(t,!1,!0))}),Qa=gi(function(t,e){return Gn(t)?Ee(t,e):[]}),Ka=gi(Nr),ts=gi(function(t){var e=t.length,n=e>2?t[e-2]:k,r=e>1?t[e-1]:k;return e>2&&"function"==typeof n?e-=2:(n=e>1&&"function"==typeof r?(--e,r):k,r=k),t.length=e,jr(t,n,r)}),es=gi(function(t){return t=Re(t),this.thru(function(e){return ee(Rs(e)?e:[lr(e)],t)})}),ns=gi(function(t,e){return ye(t,Re(e))}),rs=fn(function(t,e,n){ea.call(t,n)?++t[n]:t[n]=1}),is=bn(Pa),os=bn(Na,!0),as=Sn(re,Pa),ss=Sn(ie,Na),us=fn(function(t,e,n){ea.call(t,n)?t[n].push(e):t[n]=[e]}),cs=fn(function(t,e,n){t[n]=e}),fs=gi(function(t,e,n){var r=-1,i="function"==typeof e,o=tr(e),a=Gn(t)?zo(t.length):[];return Pa(t,function(t){var s=i?e:o&&null!=t?t[e]:k;a[++r]=s?s.apply(t,n):$n(t,e,n)}),a}),ls=fn(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),hs=Ln(fe,Pa),ps=Ln(le,Na),ds=gi(function(t,e){if(null==t)return[];var n=e[2];return n&&Kn(e[0],e[1],n)&&(e.length=1),Ge(t,Re(e),[])}),_s=Oa||function(){return(new Fo).getTime()},vs=gi(function(t,e,n){var r=O;if(n.length){var i=v(n,vs.placeholder);r|=R}return Nn(t,r,e,n,i)}),gs=gi(function(t,e){e=e.length?Re(e):$i(t);for(var n=-1,r=e.length;++n<r;){var i=e[n];t[i]=Nn(t[i],O,t)}return t}),ys=gi(function(t,e,n){var r=O|S;if(n.length){var i=v(n,ys.placeholder);r|=R}return Nn(e,r,t,n,i)}),ms=yn(C),ws=yn(x),bs=gi(function(t,e){return ke(t,1,e)}),ks=gi(function(t,e,n){return ke(t,e,n)}),Es=On(),Os=On(!0),Ss=gi(function(t,e){if(e=Re(e),"function"!=typeof t||!oe(e,r))throw new $o(U);var n=e.length;return gi(function(r){for(var i=Ea(r.length,n);i--;)r[i]=e[i](r[i]);return t.apply(this,r)})}),Ts=An(R),Cs=An(A),xs=gi(function(t,e){return Nn(t,D,k,k,k,Re(e))}),Rs=ma||function(t){return d(t)&&nr(t.length)&&ra.call(t)==q},As=ln(ze),Ls=ln(function(t,e,n){return n?ve(t,e,n):ge(t,e)}),Ds=mn(Ls,de),Is=mn(As,or),Ms=En(Le),Bs=En(De),Ps=Tn(ja),Ns=Tn(Ha),js=Cn(Le),Hs=Cn(De),Us=ba?function(t){var e=null==t?k:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&Gn(t)?cr(t):Mi(t)?ba(t):[]}:cr,zs=xn(!0),Fs=xn(),qs=gi(function(t,e){if(null==t)return{};if("function"!=typeof e[0]){var e=ue(Re(e),Zo);return ar(t,Ee(to(t),e))}var n=an(e[0],e[1],3);return sr(t,function(t,e,r){return!n(t,e,r)})}),Ws=gi(function(t,e){return null==t?{}:"function"==typeof e[0]?sr(t,an(e[0],e[1],3)):ar(t,Re(e))}),Vs=vn(function(t,e,n){return e=e.toLowerCase(),t+(n?e.charAt(0).toUpperCase()+e.slice(1):e)}),Xs=vn(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Ys=Rn(),Js=Rn(!0),Zs=vn(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),$s=vn(function(t,e,n){return t+(n?" ":"")+(e.charAt(0).toUpperCase()+e.slice(1))}),Gs=gi(function(t,e){try{return t.apply(k,e)}catch(n){return Li(n)?n:new qo(n)}}),Qs=gi(function(t,e){return function(n){return $n(n,t,e)}}),Ks=gi(function(t,e){return function(n){return $n(t,n,e)}}),tu=Bn("ceil"),eu=Bn("floor"),nu=wn(Ei,Ca),ru=wn(Vi,xa),iu=Bn("round");return J.prototype=Q.prototype,tt.prototype=Ba(Q.prototype),tt.prototype.constructor=tt,zt.prototype=Ba(Q.prototype),zt.prototype.constructor=zt,Vt.prototype["delete"]=Xt,Vt.prototype.get=Yt,Vt.prototype.has=Jt,Vt.prototype.set=Zt,$t.prototype.push=Qt,di.Cache=Vt,J.after=fi,J.ary=li,J.assign=Ls,J.at=ns,J.before=hi,J.bind=vs,J.bindAll=gs,J.bindKey=ys,J.callback=To,J.chain=zr,J.chunk=dr,J.compact=_r,J.constant=Co,J.countBy=rs,J.create=Zi,J.curry=ms,J.curryRight=ws,J.debounce=pi,J.defaults=Ds,J.defaultsDeep=Is,J.defer=bs,J.delay=ks,J.difference=Wa,J.drop=vr,J.dropRight=gr,J.dropRightWhile=yr,J.dropWhile=mr,J.fill=wr,J.filter=Gr,J.flatten=kr,J.flattenDeep=Er,J.flow=Es,J.flowRight=Os,J.forEach=as,J.forEachRight=ss,J.forIn=Ps,J.forInRight=Ns,J.forOwn=js,J.forOwnRight=Hs,J.functions=$i,J.groupBy=us,J.indexBy=cs,J.initial=Sr,J.intersection=Ya,J.invert=Ki,J.invoke=fs,J.keys=Us,J.keysIn=to,J.map=ti,J.mapKeys=zs,J.mapValues=Fs,J.matches=Ro,J.matchesProperty=Ao,J.memoize=di,J.merge=As,J.method=Qs,J.methodOf=Ks,J.mixin=Lo,J.modArgs=Ss,J.negate=_i,J.omit=qs,J.once=vi,J.pairs=eo,J.partial=Ts,J.partialRight=Cs,J.partition=ls,J.pick=Ws,J.pluck=ei,J.property=Mo,J.propertyOf=Bo,J.pull=xr,J.pullAt=Ja,J.range=Po,J.rearg=xs,J.reject=ni,J.remove=Rr,J.rest=Ar,J.restParam=gi,J.set=ro,J.shuffle=ii,J.slice=Lr,J.sortBy=si,J.sortByAll=ds,J.sortByOrder=ui,J.spread=yi,J.take=Dr,J.takeRight=Ir,J.takeRightWhile=Mr,J.takeWhile=Br,J.tap=Fr,J.throttle=mi,J.thru=qr,J.times=No,J.toArray=Yi,J.toPlainObject=Ji,J.transform=io,J.union=Ga,J.uniq=Pr,J.unzip=Nr,J.unzipWith=jr,J.values=oo,J.valuesIn=ao,J.where=ci,J.without=Qa,J.wrap=wi,J.xor=Hr,J.zip=Ka,J.zipObject=Ur,J.zipWith=ts,J.backflow=Os,J.collect=ti,J.compose=Os,J.each=as,J.eachRight=ss,J.extend=Ls,J.iteratee=To,J.methods=$i,J.object=Ur,J.select=Gr,J.tail=Ar,J.unique=Pr,Lo(J,J),J.add=Ho,J.attempt=Gs,J.camelCase=Vs,J.capitalize=co,J.ceil=tu,J.clone=bi,J.cloneDeep=ki,J.deburr=fo,J.endsWith=lo,J.escape=ho,J.escapeRegExp=po,J.every=$r,J.find=is,J.findIndex=Va,J.findKey=Ms,J.findLast=os,J.findLastIndex=Xa,J.findLastKey=Bs,J.findWhere=Qr,J.first=br,J.floor=eu,J.get=Gi,J.gt=Ei,J.gte=Oi,J.has=Qi,J.identity=xo,J.includes=Kr,J.indexOf=Or,J.inRange=so,J.isArguments=Si,J.isArray=Rs,J.isBoolean=Ti,J.isDate=Ci,J.isElement=xi,J.isEmpty=Ri,J.isEqual=Ai,J.isError=Li,J.isFinite=Di,J.isFunction=Ii,J.isMatch=Bi,J.isNaN=Pi,J.isNative=Ni,J.isNull=ji,J.isNumber=Hi,J.isObject=Mi,J.isPlainObject=Ui,J.isRegExp=zi,J.isString=Fi,J.isTypedArray=qi,J.isUndefined=Wi,J.kebabCase=Xs,J.last=Tr,J.lastIndexOf=Cr,J.lt=Vi,J.lte=Xi,J.max=nu,J.min=ru,J.noConflict=Do,J.noop=Io,J.now=_s,J.pad=_o,J.padLeft=Ys,J.padRight=Js,J.parseInt=vo,J.random=uo,J.reduce=hs,J.reduceRight=ps,J.repeat=go,J.result=no,J.round=iu,J.runInContext=b,J.size=oi,J.snakeCase=Zs,J.some=ai,J.sortedIndex=Za,J.sortedLastIndex=$a,J.startCase=$s,J.startsWith=yo,J.sum=Uo,J.template=mo,J.trim=wo,J.trimLeft=bo,J.trimRight=ko,J.trunc=Eo,J.unescape=Oo,J.uniqueId=jo,J.words=So,J.all=$r,J.any=ai,J.contains=Kr,J.eq=Ai,J.detect=is,J.foldl=hs,J.foldr=ps,J.head=br,J.include=Kr,J.inject=hs,Lo(J,function(){var t={};return Le(J,function(e,n){J.prototype[n]||(t[n]=e)}),t}(),!1),J.sample=ri,J.prototype.sample=function(t){return this.__chain__||null!=t?this.thru(function(e){return ri(e,t)}):ri(this.value())},J.VERSION=E,re(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){J[t].placeholder=J}),re(["drop","take"],function(t,e){zt.prototype[t]=function(n){var r=this.__filtered__;if(r&&!e)return new zt(this);n=null==n?1:ka(ya(n)||0,0);var i=this.clone();return r?i.__takeCount__=Ea(i.__takeCount__,n):i.__views__.push({size:n,type:t+(i.__dir__<0?"Right":"")}),i},zt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),re(["filter","map","takeWhile"],function(t,e){var n=e+1,r=n!=H;zt.prototype[t]=function(t,e){var i=this.clone();return i.__iteratees__.push({iteratee:zn(t,e,1),type:n}),i.__filtered__=i.__filtered__||r,i}}),re(["first","last"],function(t,e){var n="take"+(e?"Right":"");zt.prototype[t]=function(){return this[n](1).value()[0]}}),re(["initial","rest"],function(t,e){var n="drop"+(e?"":"Right");zt.prototype[t]=function(){return this.__filtered__?new zt(this):this[n](1)}}),re(["pluck","where"],function(t,e){var n=e?"filter":"map",r=e?He:Mo;zt.prototype[t]=function(t){return this[n](r(t))}}),zt.prototype.compact=function(){return this.filter(xo)},zt.prototype.reject=function(t,e){return t=zn(t,e,1),this.filter(function(e){return!t(e)})},zt.prototype.slice=function(t,e){t=null==t?0:+t||0;var n=this;return n.__filtered__&&(t>0||0>e)?new zt(n):(0>t?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==k&&(e=+e||0,n=0>e?n.dropRight(-e):n.take(e-t)),n)},zt.prototype.takeRightWhile=function(t,e){return this.reverse().takeWhile(t,e).reverse()},zt.prototype.toArray=function(){return this.take(xa)},Le(zt.prototype,function(t,e){var n=/^(?:filter|map|reject)|While$/.test(e),r=/^(?:first|last)$/.test(e),i=J[r?"take"+("last"==e?"Right":""):e];i&&(J.prototype[e]=function(){var e=r?[1]:arguments,o=this.__chain__,a=this.__wrapped__,s=!!this.__actions__.length,u=a instanceof zt,c=e[0],f=u||Rs(a);f&&n&&"function"==typeof c&&1!=c.length&&(u=f=!1);var l=function(t){return r&&o?i(t,1)[0]:i.apply(k,ce([t],e))},h={func:qr,args:[l],thisArg:k},p=u&&!s;if(r&&!o)return p?(a=a.clone(),a.__actions__.push(h),t.call(a)):i.call(k,this.value())[0];if(!r&&f){a=p?a:new zt(this);var d=t.apply(a,e);return d.__actions__.push(h),new tt(d,o)}return this.thru(l)})}),re(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(t){var e=(/^(?:replace|split)$/.test(t)?Ko:Go)[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:join|pop|replace|shift)$/.test(t);J.prototype[t]=function(){var t=arguments;return r&&!this.__chain__?e.apply(this.value(),t):this[n](function(n){return e.apply(n,t)})}}),Le(zt.prototype,function(t,e){var n=J[e];if(n){var r=n.name+"",i=Ma[r]||(Ma[r]=[]);i.push({name:e,func:n})}}),Ma[Dn(k,S).name]=[{name:"wrapper",func:k}],zt.prototype.clone=Ft,zt.prototype.reverse=qt,zt.prototype.value=Wt,J.prototype.chain=Wr,J.prototype.commit=Vr,J.prototype.concat=es,J.prototype.plant=Xr,J.prototype.reverse=Yr,J.prototype.toString=Jr,J.prototype.run=J.prototype.toJSON=J.prototype.valueOf=J.prototype.value=Zr,J.prototype.collect=J.prototype.map,J.prototype.head=J.prototype.first,J.prototype.select=J.prototype.filter,
J.prototype.tail=J.prototype.rest,J}var k,E="3.10.1",O=1,S=2,T=4,C=8,x=16,R=32,A=64,L=128,D=256,I=30,M="...",B=150,P=16,N=200,j=1,H=2,U="Expected a function",z="__lodash_placeholder__",F="[object Arguments]",q="[object Array]",W="[object Boolean]",V="[object Date]",X="[object Error]",Y="[object Function]",J="[object Map]",Z="[object Number]",$="[object Object]",G="[object RegExp]",Q="[object Set]",K="[object String]",tt="[object WeakMap]",et="[object ArrayBuffer]",nt="[object Float32Array]",rt="[object Float64Array]",it="[object Int8Array]",ot="[object Int16Array]",at="[object Int32Array]",st="[object Uint8Array]",ut="[object Uint8ClampedArray]",ct="[object Uint16Array]",ft="[object Uint32Array]",lt=/\b__p \+= '';/g,ht=/\b(__p \+=) '' \+/g,pt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,dt=/&(?:amp|lt|gt|quot|#39|#96);/g,_t=/[&<>"'`]/g,vt=RegExp(dt.source),gt=RegExp(_t.source),yt=/<%-([\s\S]+?)%>/g,mt=/<%([\s\S]+?)%>/g,wt=/<%=([\s\S]+?)%>/g,bt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,kt=/^\w*$/,Et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Ot=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,St=RegExp(Ot.source),Tt=/[\u0300-\u036f\ufe20-\ufe23]/g,Ct=/\\(\\)?/g,xt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Rt=/\w*$/,At=/^0[xX]/,Lt=/^\[object .+?Constructor\]$/,Dt=/^\d+$/,It=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Mt=/($^)/,Bt=/['\n\r\u2028\u2029\\]/g,Pt=function(){var t="[A-Z\\xc0-\\xd6\\xd8-\\xde]",e="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(t+"+(?="+t+e+")|"+t+"?"+e+"|"+t+"+|[0-9]+","g")}(),Nt=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],jt=-1,Ht={};Ht[nt]=Ht[rt]=Ht[it]=Ht[ot]=Ht[at]=Ht[st]=Ht[ut]=Ht[ct]=Ht[ft]=!0,Ht[F]=Ht[q]=Ht[et]=Ht[W]=Ht[V]=Ht[X]=Ht[Y]=Ht[J]=Ht[Z]=Ht[$]=Ht[G]=Ht[Q]=Ht[K]=Ht[tt]=!1;var Ut={};Ut[F]=Ut[q]=Ut[et]=Ut[W]=Ut[V]=Ut[nt]=Ut[rt]=Ut[it]=Ut[ot]=Ut[at]=Ut[Z]=Ut[$]=Ut[G]=Ut[K]=Ut[st]=Ut[ut]=Ut[ct]=Ut[ft]=!0,Ut[X]=Ut[Y]=Ut[J]=Ut[Q]=Ut[tt]=!1;var zt={"":"A","":"A","":"A","":"A","":"A","":"A","":"a","":"a","":"a","":"a","":"a","":"a","":"C","":"c","":"D","":"d","":"E","":"E","":"E","":"E","":"e","":"e","":"e","":"e","":"I","":"I","":"I","":"I","":"i","":"i","":"i","":"i","":"N","":"n","":"O","":"O","":"O","":"O","":"O","":"O","":"o","":"o","":"o","":"o","":"o","":"o","":"U","":"U","":"U","":"U","":"u","":"u","":"u","":"u","":"Y","":"y","":"y","":"Ae","":"ae","":"Th","":"th","":"ss"},Ft={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},qt={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},Wt={"function":!0,object:!0},Vt={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Xt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Yt=Wt[typeof exports]&&exports&&!exports.nodeType&&exports,Jt=Wt[typeof module]&&module&&!module.nodeType&&module,Zt=Yt&&Jt&&"object"==typeof global&&global&&global.Object&&global,$t=Wt[typeof self]&&self&&self.Object&&self,Gt=Wt[typeof window]&&window&&window.Object&&window,Qt=Jt&&Jt.exports===Yt&&Yt,Kt=Zt||Gt!==(this&&this.window)&&Gt||$t||this,te=b();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Kt._=te,define(function(){return te})):Yt&&Jt?Qt?(Jt.exports=te)._=te:Yt._=te:Kt._=te}.call(this),function t(e,n,r){function i(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};e[a][0].call(f.exports,function(t){var n=e[a][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){e.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,e.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,e.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(t,e,n){function r(t,e,n){return this instanceof r?(o.call(this),this.options=i.extend({serialization:"binary",reliable:!1},n),this.open=!1,this.type="data",this.peer=t,this.provider=e,this.id=this.options.connectionId||r._idPrefix+i.randomToken(),this.label=this.options.label||this.id,this.metadata=this.options.metadata,this.serialization=this.options.serialization,this.reliable=this.options.reliable,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},this.options._payload&&(this._peerBrowser=this.options._payload.browser),void a.startConnection(this,this.options._payload||{originator:!0})):new r(t,e,n)}var i=t("./util"),o=t("eventemitter3"),a=t("./negotiator"),s=t("reliable");i.inherits(r,o),r._idPrefix="dc_",r.prototype.initialize=function(t){this._dc=this.dataChannel=t,this._configureDataChannel()},r.prototype._configureDataChannel=function(){var t=this;i.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){i.log("Data channel connection success"),t.open=!0,t.emit("open")},!i.supports.sctp&&this.reliable&&(this._reliable=new s(this._dc,i.debug)),this._reliable?this._reliable.onmessage=function(e){t.emit("data",e)}:this._dc.onmessage=function(e){t._handleDataMessage(e)},this._dc.onclose=function(e){i.log("DataChannel closed for:",t.peer),t.close()}},r.prototype._handleDataMessage=function(t){var e=this,n=t.data,r=n.constructor;if("binary"===this.serialization||"binary-utf8"===this.serialization){if(r===Blob)return void i.blobToArrayBuffer(n,function(t){n=i.unpack(t),e.emit("data",n)});if(r===ArrayBuffer)n=i.unpack(n);else if(r===String){var o=i.binaryStringToArrayBuffer(n);n=i.unpack(o)}}else"json"===this.serialization&&(n=JSON.parse(n));if(n.__peerData){var a=n.__peerData,s=this._chunkedData[a]||{data:[],count:0,total:n.total};return s.data[n.n]=n.data,s.count+=1,s.total===s.count&&(delete this._chunkedData[a],n=new Blob(s.data),this._handleDataMessage({data:n})),void(this._chunkedData[a]=s)}this.emit("data",n)},r.prototype.close=function(){this.open&&(this.open=!1,a.cleanup(this),this.emit("close"))},r.prototype.send=function(t,e){if(!this.open)return void this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));if(this._reliable)return void this._reliable.send(t);var n=this;if("json"===this.serialization)this._bufferedSend(JSON.stringify(t));else if("binary"===this.serialization||"binary-utf8"===this.serialization){var r=i.pack(t),o=i.chunkedBrowsers[this._peerBrowser]||i.chunkedBrowsers[i.browser];if(o&&!e&&r.size>i.chunkedMTU)return void this._sendChunks(r);i.supports.sctp?i.supports.binaryBlob?this._bufferedSend(r):i.blobToArrayBuffer(r,function(t){n._bufferedSend(t)}):i.blobToBinaryString(r,function(t){n._bufferedSend(t)})}else this._bufferedSend(t)},r.prototype._bufferedSend=function(t){!this._buffering&&this._trySend(t)||(this._buffer.push(t),this.bufferSize=this._buffer.length)},r.prototype._trySend=function(t){try{this._dc.send(t)}catch(e){this._buffering=!0;var n=this;return setTimeout(function(){n._buffering=!1,n._tryBuffer()},100),!1}return!0},r.prototype._tryBuffer=function(){if(0!==this._buffer.length){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},r.prototype._sendChunks=function(t){for(var e=i.chunk(t),n=0,r=e.length;r>n;n+=1){var t=e[n];this.send(t,!0)}},r.prototype.handleMessage=function(t){var e=t.payload;switch(t.type){case"ANSWER":this._peerBrowser=e.browser,a.handleSDP(t.type,this,e.sdp);break;case"CANDIDATE":a.handleCandidate(this,e.candidate);break;default:i.warn("Unrecognized message type:",t.type,"from peer:",this.peer)}},e.exports=r},{"./negotiator":5,"./util":8,eventemitter3:9,reliable:12}],3:[function(t,e,n){window.Socket=t("./socket"),window.MediaConnection=t("./mediaconnection"),window.DataConnection=t("./dataconnection"),window.Peer=t("./peer"),window.RTCPeerConnection=t("./adapter").RTCPeerConnection,window.RTCSessionDescription=t("./adapter").RTCSessionDescription,window.RTCIceCandidate=t("./adapter").RTCIceCandidate,window.Negotiator=t("./negotiator"),window.util=t("./util"),window.BinaryPack=t("js-binarypack")},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8,"js-binarypack":10}],4:[function(t,e,n){function r(t,e,n){return this instanceof r?(o.call(this),this.options=i.extend({},n),this.open=!1,this.type="media",this.peer=t,this.provider=e,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||r._idPrefix+i.randomToken(),void(this.localStream&&a.startConnection(this,{_stream:this.localStream,originator:!0}))):new r(t,e,n)}var i=t("./util"),o=t("eventemitter3"),a=t("./negotiator");i.inherits(r,o),r._idPrefix="mc_",r.prototype.addStream=function(t){i.log("Receiving stream",t),this.remoteStream=t,this.emit("stream",t)},r.prototype.handleMessage=function(t){var e=t.payload;switch(t.type){case"ANSWER":a.handleSDP(t.type,this,e.sdp),this.open=!0;break;case"CANDIDATE":a.handleCandidate(this,e.candidate);break;default:i.warn("Unrecognized message type:",t.type,"from peer:",this.peer)}},r.prototype.answer=function(t){if(this.localStream)return void i.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");this.options._payload._stream=t,this.localStream=t,a.startConnection(this,this.options._payload);for(var e=this.provider._getMessages(this.id),n=0,r=e.length;r>n;n+=1)this.handleMessage(e[n]);this.open=!0},r.prototype.close=function(){this.open&&(this.open=!1,a.cleanup(this),this.emit("close"))},e.exports=r},{"./negotiator":5,"./util":8,eventemitter3:9}],5:[function(t,e,n){var r=t("./util"),i=t("./adapter").RTCPeerConnection,o=t("./adapter").RTCSessionDescription,a=t("./adapter").RTCIceCandidate,s={pcs:{data:{},media:{}},queue:[]};s._idPrefix="pc_",s.startConnection=function(t,e){var n=s._getPeerConnection(t,e);if("media"===t.type&&e._stream&&n.addStream(e._stream),t.pc=t.peerConnection=n,e.originator){if("data"===t.type){var i={};r.supports.sctp||(i={reliable:e.reliable});var o=n.createDataChannel(t.label,i);t.initialize(o)}r.supports.onnegotiationneeded||s._makeOffer(t)}else s.handleSDP("OFFER",t,e.sdp)},s._getPeerConnection=function(t,e){s.pcs[t.type]||r.error(t.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),s.pcs[t.type][t.peer]||(s.pcs[t.type][t.peer]={});var n;s.pcs[t.type][t.peer];return e.pc&&(n=s.pcs[t.type][t.peer][e.pc]),n&&"stable"===n.signalingState||(n=s._startPeerConnection(t)),n},s._startPeerConnection=function(t){r.log("Creating RTCPeerConnection.");var e=s._idPrefix+r.randomToken(),n={};"data"!==t.type||r.supports.sctp?"media"===t.type&&(n={optional:[{DtlsSrtpKeyAgreement:!0}]}):n={optional:[{RtpDataChannels:!0}]};var o=new i(t.provider.options.config,n);return s.pcs[t.type][t.peer][e]=o,s._setupListeners(t,o,e),o},s._setupListeners=function(t,e,n){var i=t.peer,o=t.id,a=t.provider;r.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&(r.log("Received ICE candidates for:",t.peer),a.socket.send({type:"CANDIDATE",payload:{candidate:e.candidate,type:t.type,connectionId:t.id},dst:i}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"disconnected":case"failed":r.log("iceConnectionState is disconnected, closing connections to "+i),t.close();break;case"completed":e.onicecandidate=r.noop}},e.onicechange=e.oniceconnectionstatechange,r.log("Listening for `negotiationneeded`"),e.onnegotiationneeded=function(){r.log("`negotiationneeded` triggered"),"stable"==e.signalingState?s._makeOffer(t):r.log("onnegotiationneeded triggered when not stable. Is another connection being established?")},r.log("Listening for data channel"),e.ondatachannel=function(t){r.log("Received data channel");var e=t.channel,n=a.getConnection(i,o);n.initialize(e)},r.log("Listening for remote stream"),e.onaddstream=function(t){r.log("Received remote stream");var e=t.stream,n=a.getConnection(i,o);"media"===n.type&&n.addStream(e)}},s.cleanup=function(t){r.log("Cleaning up PeerConnection to "+t.peer);var e=t.pc;!e||"closed"===e.readyState&&"closed"===e.signalingState||(e.close(),t.pc=null)},s._makeOffer=function(t){var e=t.pc;e.createOffer(function(n){r.log("Created offer."),!r.supports.sctp&&"data"===t.type&&t.reliable&&(n.sdp=Reliable.higherBandwidthSDP(n.sdp)),e.setLocalDescription(n,function(){r.log("Set localDescription: offer","for:",t.peer),t.provider.socket.send({type:"OFFER",payload:{sdp:n,type:t.type,label:t.label,connectionId:t.id,reliable:t.reliable,serialization:t.serialization,metadata:t.metadata,browser:r.browser},dst:t.peer})},function(e){t.provider.emitError("webrtc",e),r.log("Failed to setLocalDescription, ",e)})},function(e){t.provider.emitError("webrtc",e),r.log("Failed to createOffer, ",e)},t.options.constraints)},s._makeAnswer=function(t){var e=t.pc;e.createAnswer(function(n){r.log("Created answer."),!r.supports.sctp&&"data"===t.type&&t.reliable&&(n.sdp=Reliable.higherBandwidthSDP(n.sdp)),e.setLocalDescription(n,function(){r.log("Set localDescription: answer","for:",t.peer),t.provider.socket.send({type:"ANSWER",payload:{sdp:n,type:t.type,connectionId:t.id,browser:r.browser},dst:t.peer})},function(e){t.provider.emitError("webrtc",e),r.log("Failed to setLocalDescription, ",e)})},function(e){t.provider.emitError("webrtc",e),r.log("Failed to create answer, ",e)})},s.handleSDP=function(t,e,n){n=new o(n);var i=e.pc;r.log("Setting remote description",n),i.setRemoteDescription(n,function(){r.log("Set remoteDescription:",t,"for:",e.peer),"OFFER"===t&&s._makeAnswer(e)},function(t){e.provider.emitError("webrtc",t),r.log("Failed to setRemoteDescription, ",t)})},s.handleCandidate=function(t,e){var n=e.candidate,i=e.sdpMLineIndex;t.pc.addIceCandidate(new a({sdpMLineIndex:i,candidate:n})),r.log("Added ICE candidate for:",t.peer)},e.exports=s},{"./adapter":1,"./util":8}],6:[function(t,e,n){function r(t,e){return this instanceof r?(o.call(this),t&&t.constructor==Object?(e=t,t=void 0):t&&(t=t.toString()),e=i.extend({debug:0,host:i.CLOUD_HOST,port:i.CLOUD_PORT,key:"peerjs",path:"/",token:i.randomToken(),config:i.defaultConfig},e),this.options=e,"/"===e.host&&(e.host=window.location.hostname),"/"!==e.path[0]&&(e.path="/"+e.path),"/"!==e.path[e.path.length-1]&&(e.path+="/"),void 0===e.secure&&e.host!==i.CLOUD_HOST&&(e.secure=i.isSecure()),e.logFunction&&i.setLogFunction(e.logFunction),i.setLogLevel(e.debug),i.supports.audioVideo||i.supports.data?i.validateId(t)?i.validateKey(e.key)?e.secure&&"0.peerjs.com"===e.host?void this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS."):(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),void(t?this._initialize(t):this._retrieveId())):void this._delayedAbort("invalid-key",'API KEY "'+e.key+'" is invalid'):void this._delayedAbort("invalid-id",'ID "'+t+'" is invalid'):void this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")):new r(t,e)}var i=t("./util"),o=t("eventemitter3"),a=t("./socket"),s=t("./mediaconnection"),u=t("./dataconnection");i.inherits(r,o),r.prototype._initializeServerConnection=function(){var t=this;this.socket=new a(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key),this.socket.on("message",function(e){t._handleMessage(e)}),this.socket.on("error",function(e){t._abort("socket-error",e)}),this.socket.on("disconnected",function(){t.disconnected||(t.emitError("network","Lost connection to server."),t.disconnect())}),this.socket.on("close",function(){t.disconnected||t._abort("socket-closed","Underlying socket is already closed.")})},r.prototype._retrieveId=function(t){var e=this,n=new XMLHttpRequest,r=this.options.secure?"https://":"http://",o=r+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/id",a="?ts="+(new Date).getTime()+Math.random();o+=a,n.open("get",o,!0),n.onerror=function(t){i.error("Error retrieving ID",t);var n="";"/"===e.options.path&&e.options.host!==i.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),e._abort("server-error","Could not get an ID from the server."+n)},n.onreadystatechange=function(){return 4===n.readyState?200!==n.status?void n.onerror():void e._initialize(n.responseText):void 0},n.send(null)},r.prototype._initialize=function(t){this.id=t,this.socket.start(this.id,this.options.token)},r.prototype._handleMessage=function(t){var e,n=t.type,r=t.payload,o=t.src;switch(n){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",r.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":i.log("Received leave message from",o),this._cleanupPeer(o);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+o);break;case"OFFER":var a=r.connectionId;if(e=this.getConnection(o,a))i.warn("Offer received for existing Connection ID:",a);else{if("media"===r.type)e=new s(o,this,{connectionId:a,_payload:r,metadata:r.metadata}),this._addConnection(o,e),this.emit("call",e);else{if("data"!==r.type)return void i.warn("Received malformed connection type:",r.type);e=new u(o,this,{connectionId:a,_payload:r,metadata:r.metadata,label:r.label,serialization:r.serialization,reliable:r.reliable}),this._addConnection(o,e),this.emit("connection",e)}for(var c=this._getMessages(a),f=0,l=c.length;l>f;f+=1)e.handleMessage(c[f])}break;default:if(!r)return void i.warn("You received a malformed message from "+o+" of type "+n);var h=r.connectionId;e=this.getConnection(o,h),e&&e.pc?e.handleMessage(t):h?this._storeMessage(h,t):i.warn("You received an unrecognized message:",t)}},r.prototype._storeMessage=function(t,e){this._lostMessages[t]||(this._lostMessages[t]=[]),this._lostMessages[t].push(e)},r.prototype._getMessages=function(t){var e=this._lostMessages[t];return e?(delete this._lostMessages[t],e):[]},r.prototype.connect=function(t,e){if(this.disconnected)return i.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var n=new u(t,this,e);return this._addConnection(t,n),n},r.prototype.call=function(t,e,n){if(this.disconnected)return i.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");if(!e)return void i.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");n=n||{},n._stream=e;var r=new s(t,this,n);return this._addConnection(t,r),r},r.prototype._addConnection=function(t,e){this.connections[t]||(this.connections[t]=[]),this.connections[t].push(e)},r.prototype.getConnection=function(t,e){var n=this.connections[t];if(!n)return null;for(var r=0,i=n.length;i>r;r++)if(n[r].id===e)return n[r];return null},r.prototype._delayedAbort=function(t,e){var n=this;i.setZeroTimeout(function(){n._abort(t,e)})},r.prototype._abort=function(t,e){i.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(t,e)},r.prototype.emitError=function(t,e){i.error("Error:",e),"string"==typeof e&&(e=new Error(e)),e.type=t,this.emit("error",e)},r.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},r.prototype._cleanup=function(){if(this.connections)for(var t=Object.keys(this.connections),e=0,n=t.length;n>e;e++)this._cleanupPeer(t[e]);this.emit("close")},r.prototype._cleanupPeer=function(t){for(var e=this.connections[t],n=0,r=e.length;r>n;n+=1)e[n].close()},r.prototype.disconnect=function(){var t=this;i.setZeroTimeout(function(){t.disconnected||(t.disconnected=!0,t.open=!1,t.socket&&t.socket.close(),t.emit("disconnected",t.id),t._lastServerId=t.id,t.id=null)})},r.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)i.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");i.error("In a hurry? We're still trying to make the initial connection!")}},r.prototype.listAllPeers=function(t){t=t||function(){};var e=this,n=new XMLHttpRequest,r=this.options.secure?"https://":"http://",o=r+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers",a="?ts="+(new Date).getTime()+Math.random();o+=a,n.open("get",o,!0),n.onerror=function(n){e._abort("server-error","Could not get peers from the server."),t([])},n.onreadystatechange=function(){if(4===n.readyState){if(401===n.status){var r="";throw r=e.options.host!==i.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",t([]),new Error("It doesn't look like you have permission to list peers IDs. "+r)}t(200!==n.status?[]:JSON.parse(n.responseText))}},n.send(null)},e.exports=r},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,eventemitter3:9}],7:[function(t,e,n){function r(t,e,n,i,a){if(!(this instanceof r))return new r(t,e,n,i,a);o.call(this),this.disconnected=!1,this._queue=[];var s=t?"https://":"http://",u=t?"wss://":"ws://";this._httpUrl=s+e+":"+n+i+a,this._wsUrl=u+e+":"+n+i+"peerjs?key="+a}var i=t("./util"),o=t("eventemitter3");i.inherits(r,o),r.prototype.start=function(t,e){this.id=t,this._httpUrl+="/"+t+"/"+e,this._wsUrl+="&id="+t+"&token="+e,this._startXhrStream(),this._startWebSocket()},r.prototype._startWebSocket=function(t){var e=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(t){try{var n=JSON.parse(t.data)}catch(r){return void i.log("Invalid server message",t.data)}e.emit("message",n)},this._socket.onclose=function(t){i.log("Socket closed."),e.disconnected=!0,e.emit("disconnected")},this._socket.onopen=function(){e._timeout&&(clearTimeout(e._timeout),setTimeout(function(){e._http.abort(),e._http=null},5e3)),e._sendQueuedMessages(),i.log("Socket open")})},r.prototype._startXhrStream=function(t){try{var e=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=t||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(e._timeout),e.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&200===this.status&&this.responseText&&e._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(n){i.log("XMLHttpRequest not available; defaulting to WebSockets")}},r.prototype._handleStream=function(t){var e=t.responseText.split("\n");if(t._buffer)for(;t._buffer.length>0;){var n=t._buffer.shift(),r=e[n];try{r=JSON.parse(r)}catch(o){t._buffer.shift(n);break}this.emit("message",r)}var a=e[t._index];if(a)if(t._index+=1,t._index===e.length)t._buffer||(t._buffer=[]),t._buffer.push(t._index-1);else{try{a=JSON.parse(a)}catch(o){return void i.log("Invalid server message",a)}this.emit("message",a)}},r.prototype._setHTTPTimeout=function(){var t=this;this._timeout=setTimeout(function(){var e=t._http;t._wsOpen()?e.abort():(t._startXhrStream(e._streamIndex+1),t._http.old=e)},25e3)},r.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},r.prototype._sendQueuedMessages=function(){for(var t=0,e=this._queue.length;e>t;t+=1)this.send(this._queue[t])},r.prototype.send=function(t){if(!this.disconnected){if(!this.id)return void this._queue.push(t);if(!t.type)return void this.emit("error","Invalid message");var e=JSON.stringify(t);if(this._wsOpen())this._socket.send(e);else{var n=new XMLHttpRequest,r=this._httpUrl+"/"+t.type.toLowerCase();n.open("post",r,!0),n.setRequestHeader("Content-Type","application/json"),n.send(e)}}},r.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)},e.exports=r},{"./util":8,eventemitter3:9}],8:[function(t,e,n){var r={iceServers:[{url:"stun:stun.l.google.com:19302"}]},i=1,o=t("js-binarypack"),a=t("./adapter").RTCPeerConnection,s={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(t){var e=parseInt(t,10);isNaN(parseInt(t,10))?s.logLevel=t?3:0:s.logLevel=e,s.log=s.warn=s.error=s.noop,s.logLevel>0&&(s.error=s._printWith("ERROR")),s.logLevel>1&&(s.warn=s._printWith("WARNING")),s.logLevel>2&&(s.log=s._print)},setLogFunction:function(t){t.constructor!==Function?s.warn("The log function you passed in is not a function. Defaulting to regular logs."):s._print=t},_printWith:function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t),s._print.apply(s,e)}},_print:function(){var t=!1,e=Array.prototype.slice.call(arguments);e.unshift("PeerJS: ");for(var n=0,r=e.length;r>n;n++)e[n]instanceof Error&&(e[n]="("+e[n].name+") "+e[n].message,t=!0);t?console.error.apply(console,e):console.log.apply(console,e)},defaultConfig:r,browser:function(){return window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported"}(),supports:function(){if("undefined"==typeof a)return{};var t,e,n=!0,i=!0,o=!1,u=!1,c=!!window.webkitRTCPeerConnection;try{t=new a(r,{optional:[{RtpDataChannels:!0}]})}catch(f){n=!1,i=!1}if(n)try{e=t.createDataChannel("_PEERJSTEST")}catch(f){n=!1}if(n){try{e.binaryType="blob",o=!0}catch(f){}var l=new a(r,{});try{var h=l.createDataChannel("_PEERJSRELIABLETEST",{});u=h.reliable}catch(f){}l.close()}if(i&&(i=!!t.addStream),!c&&n){var p=new a(r,{optional:[{RtpDataChannels:!0}]});p.onnegotiationneeded=function(){c=!0,s&&s.supports&&(s.supports.onnegotiationneeded=!0)},p.createDataChannel("_PEERJSNEGOTIATIONTEST"),setTimeout(function(){p.close()},1e3)}return t&&t.close(),{audioVideo:i,data:n,binaryBlob:o,binary:u,reliable:u,sctp:u,onnegotiationneeded:c}}(),validateId:function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(t)},validateKey:function(t){return!t||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(t)},debug:!1,inherits:function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},pack:o.pack,unpack:o.unpack,log:function(){if(s.debug){var t=!1,e=Array.prototype.slice.call(arguments);e.unshift("PeerJS: ");for(var n=0,r=e.length;r>n;n++)e[n]instanceof Error&&(e[n]="("+e[n].name+") "+e[n].message,t=!0);t?console.error.apply(console,e):console.log.apply(console,e)}},setZeroTimeout:function(t){function e(e){r.push(e),t.postMessage(i,"*")}function n(e){e.source==t&&e.data==i&&(e.stopPropagation&&e.stopPropagation(),r.length&&r.shift()())}var r=[],i="zero-timeout-message";return t.addEventListener?t.addEventListener("message",n,!0):t.attachEvent&&t.attachEvent("onmessage",n),e}(window),chunk:function(t){for(var e=[],n=t.size,r=index=0,o=Math.ceil(n/s.chunkedMTU);n>r;){var a=Math.min(n,r+s.chunkedMTU),u=t.slice(r,a),c={__peerData:i,n:index,data:u,total:o};e.push(c),r=a,index+=1}return i+=1,e},blobToArrayBuffer:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)},blobToBinaryString:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsBinaryString(t)},binaryStringToArrayBuffer:function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=255&t.charCodeAt(n);return e.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};e.exports=s},{"./adapter":1,"js-binarypack":10}],9:[function(t,e,n){"use strict";function r(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(){}i.prototype._events=void 0,i.prototype.listeners=function(t){if(!this._events||!this._events[t])return[];for(var e=0,n=this._events[t].length,r=[];n>e;e++)r.push(this._events[t][e].fn);return r},i.prototype.emit=function(t,e,n,r,i,o){if(!this._events||!this._events[t])return!1;var a,s,u,c=this._events[t],f=c.length,l=arguments.length,h=c[0];if(1===f){switch(h.once&&this.removeListener(t,h.fn,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,i),!0;case 6:return h.fn.call(h.context,e,n,r,i,o),!0}for(s=1,a=new Array(l-1);l>s;s++)a[s-1]=arguments[s];h.fn.apply(h.context,a)}else for(s=0;f>s;s++)switch(c[s].once&&this.removeListener(t,c[s].fn,!0),l){case 1:c[s].fn.call(c[s].context);break;case 2:c[s].fn.call(c[s].context,e);break;case 3:c[s].fn.call(c[s].context,e,n);break;default:if(!a)for(u=1,a=new Array(l-1);l>u;u++)a[u-1]=arguments[u];c[s].fn.apply(c[s].context,a)}return!0},i.prototype.on=function(t,e,n){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(new r(e,n||this)),this},i.prototype.once=function(t,e,n){return this._events||(this._events={}),this._events[t]||(this._events[t]=[]),this._events[t].push(new r(e,n||this,!0)),this},i.prototype.removeListener=function(t,e,n){if(!this._events||!this._events[t])return this;var r=this._events[t],i=[];if(e)for(var o=0,a=r.length;a>o;o++)r[o].fn!==e&&r[o].once!==n&&i.push(r[o]);return i.length?this._events[t]=i:this._events[t]=null,this},i.prototype.removeAllListeners=function(t){return this._events?(t?this._events[t]=null:this._events={},this):this},i.prototype.off=i.prototype.removeListener,i.prototype.addListener=i.prototype.on,i.prototype.setMaxListeners=function(){return this},i.EventEmitter=i,i.EventEmitter2=i,i.EventEmitter3=i,"object"==typeof e&&e.exports&&(e.exports=i)},{}],10:[function(t,e,n){function r(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function i(){this.bufferBuilder=new s}function o(t){var e=t.charCodeAt(0);return 2047>=e?"00":65535>=e?"000":2097151>=e?"0000":67108863>=e?"00000":"000000"}function a(t){return t.length>600?new Blob([t]).size:t.replace(/[^\u0000-\u007F]/g,o).length}var s=t("./bufferbuilder").BufferBuilder,u=t("./bufferbuilder").binaryFeatures,c={unpack:function(t){var e=new r(t);return e.unpack()},pack:function(t){var e=new i;e.pack(t);var n=e.getBuffer();return n}};e.exports=c,r.prototype.unpack=function(){var t=this.unpack_uint8();if(128>t){var e=t;return e}if(32>(224^t)){var n=(224^t)-32;return n}var r;if((r=160^t)<=15)return this.unpack_raw(r);if((r=176^t)<=15)return this.unpack_string(r);if((r=144^t)<=15)return this.unpack_array(r);
if((r=128^t)<=15)return this.unpack_map(r);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return r=this.unpack_uint16(),this.unpack_string(r);case 217:return r=this.unpack_uint32(),this.unpack_string(r);case 218:return r=this.unpack_uint16(),this.unpack_raw(r);case 219:return r=this.unpack_uint32(),this.unpack_raw(r);case 220:return r=this.unpack_uint16(),this.unpack_array(r);case 221:return r=this.unpack_uint32(),this.unpack_array(r);case 222:return r=this.unpack_uint16(),this.unpack_map(r);case 223:return r=this.unpack_uint32(),this.unpack_map(r)}},r.prototype.unpack_uint8=function(){var t=255&this.dataView[this.index];return this.index++,t},r.prototype.unpack_uint16=function(){var t=this.read(2),e=256*(255&t[0])+(255&t[1]);return this.index+=2,e},r.prototype.unpack_uint32=function(){var t=this.read(4),e=256*(256*(256*t[0]+t[1])+t[2])+t[3];return this.index+=4,e},r.prototype.unpack_uint64=function(){var t=this.read(8),e=256*(256*(256*(256*(256*(256*(256*t[0]+t[1])+t[2])+t[3])+t[4])+t[5])+t[6])+t[7];return this.index+=8,e},r.prototype.unpack_int8=function(){var t=this.unpack_uint8();return 128>t?t:t-256},r.prototype.unpack_int16=function(){var t=this.unpack_uint16();return 32768>t?t:t-65536},r.prototype.unpack_int32=function(){var t=this.unpack_uint32();return t<Math.pow(2,31)?t:t-Math.pow(2,32)},r.prototype.unpack_int64=function(){var t=this.unpack_uint64();return t<Math.pow(2,63)?t:t-Math.pow(2,64)},r.prototype.unpack_raw=function(t){if(this.length<this.index+t)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+t+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,e},r.prototype.unpack_string=function(t){for(var e,n,r=this.read(t),i=0,o="";t>i;)e=r[i],128>e?(o+=String.fromCharCode(e),i++):32>(192^e)?(n=(192^e)<<6|63&r[i+1],o+=String.fromCharCode(n),i+=2):(n=(15&e)<<12|(63&r[i+1])<<6|63&r[i+2],o+=String.fromCharCode(n),i+=3);return this.index+=t,o},r.prototype.unpack_array=function(t){for(var e=new Array(t),n=0;t>n;n++)e[n]=this.unpack();return e},r.prototype.unpack_map=function(t){for(var e={},n=0;t>n;n++){var r=this.unpack(),i=this.unpack();e[r]=i}return e},r.prototype.unpack_float=function(){var t=this.unpack_uint32(),e=t>>31,n=(t>>23&255)-127,r=8388607&t|8388608;return(0==e?1:-1)*r*Math.pow(2,n-23)},r.prototype.unpack_double=function(){var t=this.unpack_uint32(),e=this.unpack_uint32(),n=t>>31,r=(t>>20&2047)-1023,i=1048575&t|1048576,o=i*Math.pow(2,r-20)+e*Math.pow(2,r-52);return(0==n?1:-1)*o},r.prototype.read=function(t){var e=this.index;if(e+t<=this.length)return this.dataView.subarray(e,e+t);throw new Error("BinaryPackFailure: read index out of range")},i.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},i.prototype.pack=function(t){var e=typeof t;if("string"==e)this.pack_string(t);else if("number"==e)Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if("boolean"==e)t===!0?this.bufferBuilder.append(195):t===!1&&this.bufferBuilder.append(194);else if("undefined"==e)this.bufferBuilder.append(192);else{if("object"!=e)throw new Error('Type "'+e+'" not yet supported');if(null===t)this.bufferBuilder.append(192);else{var n=t.constructor;if(n==Array)this.pack_array(t);else if(n==Blob||n==File)this.pack_bin(t);else if(n==ArrayBuffer)u.useArrayBufferView?this.pack_bin(new Uint8Array(t)):this.pack_bin(t);else if("BYTES_PER_ELEMENT"in t)u.useArrayBufferView?this.pack_bin(new Uint8Array(t.buffer)):this.pack_bin(t.buffer);else if(n==Object)this.pack_object(t);else if(n==Date)this.pack_string(t.toString());else{if("function"!=typeof t.toBinaryPack)throw new Error('Type "'+n.toString()+'" not yet supported');this.bufferBuilder.append(t.toBinaryPack())}}}this.bufferBuilder.flush()},i.prototype.pack_bin=function(t){var e=t.length||t.byteLength||t.size;if(15>=e)this.pack_uint8(160+e);else if(65535>=e)this.bufferBuilder.append(218),this.pack_uint16(e);else{if(!(4294967295>=e))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(e)}this.bufferBuilder.append(t)},i.prototype.pack_string=function(t){var e=a(t);if(15>=e)this.pack_uint8(176+e);else if(65535>=e)this.bufferBuilder.append(216),this.pack_uint16(e);else{if(!(4294967295>=e))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(e)}this.bufferBuilder.append(t)},i.prototype.pack_array=function(t){var e=t.length;if(15>=e)this.pack_uint8(144+e);else if(65535>=e)this.bufferBuilder.append(220),this.pack_uint16(e);else{if(!(4294967295>=e))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(e)}for(var n=0;e>n;n++)this.pack(t[n])},i.prototype.pack_integer=function(t){if(t>=-32&&127>=t)this.bufferBuilder.append(255&t);else if(t>=0&&255>=t)this.bufferBuilder.append(204),this.pack_uint8(t);else if(t>=-128&&127>=t)this.bufferBuilder.append(208),this.pack_int8(t);else if(t>=0&&65535>=t)this.bufferBuilder.append(205),this.pack_uint16(t);else if(t>=-32768&&32767>=t)this.bufferBuilder.append(209),this.pack_int16(t);else if(t>=0&&4294967295>=t)this.bufferBuilder.append(206),this.pack_uint32(t);else if(t>=-2147483648&&2147483647>=t)this.bufferBuilder.append(210),this.pack_int32(t);else if(t>=-0x8000000000000000&&0x8000000000000000>=t)this.bufferBuilder.append(211),this.pack_int64(t);else{if(!(t>=0&&0x10000000000000000>=t))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(t)}},i.prototype.pack_double=function(t){var e=0;0>t&&(e=1,t=-t);var n=Math.floor(Math.log(t)/Math.LN2),r=t/Math.pow(2,n)-1,i=Math.floor(r*Math.pow(2,52)),o=Math.pow(2,32),a=e<<31|n+1023<<20|i/o&1048575,s=i%o;this.bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(s)},i.prototype.pack_object=function(t){var e=Object.keys(t),n=e.length;if(15>=n)this.pack_uint8(128+n);else if(65535>=n)this.bufferBuilder.append(222),this.pack_uint16(n);else{if(!(4294967295>=n))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(n)}for(var r in t)t.hasOwnProperty(r)&&(this.pack(r),this.pack(t[r]))},i.prototype.pack_uint8=function(t){this.bufferBuilder.append(t)},i.prototype.pack_uint16=function(t){this.bufferBuilder.append(t>>8),this.bufferBuilder.append(255&t)},i.prototype.pack_uint32=function(t){var e=4294967295&t;this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},i.prototype.pack_uint64=function(t){var e=t/Math.pow(2,32),n=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)},i.prototype.pack_int8=function(t){this.bufferBuilder.append(255&t)},i.prototype.pack_int16=function(t){this.bufferBuilder.append((65280&t)>>8),this.bufferBuilder.append(255&t)},i.prototype.pack_int32=function(t){this.bufferBuilder.append(t>>>24&255),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},i.prototype.pack_int64=function(t){var e=Math.floor(t/Math.pow(2,32)),n=t%Math.pow(2,32);this.bufferBuilder.append((4278190080&e)>>>24),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e),this.bufferBuilder.append((4278190080&n)>>>24),this.bufferBuilder.append((16711680&n)>>>16),this.bufferBuilder.append((65280&n)>>>8),this.bufferBuilder.append(255&n)}},{"./bufferbuilder":11}],11:[function(t,e,n){function r(){this._pieces=[],this._parts=[]}var i={};i.useBlobBuilder=function(){try{return new Blob([]),!1}catch(t){return!0}}(),i.useArrayBufferView=!i.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(t){return!0}}(),e.exports.binaryFeatures=i;var o=e.exports.BlobBuilder;"undefined"!=typeof window&&(o=e.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),r.prototype.append=function(t){"number"==typeof t?this._pieces.push(t):(this.flush(),this._parts.push(t))},r.prototype.flush=function(){if(this._pieces.length>0){var t=new Uint8Array(this._pieces);i.useArrayBufferView||(t=t.buffer),this._parts.push(t),this._pieces=[]}},r.prototype.getBuffer=function(){if(this.flush(),i.useBlobBuilder){for(var t=new o,e=0,n=this._parts.length;n>e;e++)t.append(this._parts[e]);return t.getBlob()}return new Blob(this._parts)},e.exports.BufferBuilder=r},{}],12:[function(t,e,n){function r(t,e){return this instanceof r?(this._dc=t,i.debug=e,this._outgoing={},this._incoming={},this._received={},this._window=1e3,this._mtu=500,this._interval=0,this._count=0,this._queue=[],void this._setupDC()):new r(t)}var i=t("./util");r.prototype.send=function(t){var e=i.pack(t);return e.size<this._mtu?void this._handleSend(["no",e]):(this._outgoing[this._count]={ack:0,chunks:this._chunk(e)},i.debug&&(this._outgoing[this._count].timer=new Date),this._sendWindowedChunks(this._count),void(this._count+=1))},r.prototype._setupInterval=function(){var t=this;this._timeout=setInterval(function(){var e=t._queue.shift();if(e._multiple)for(var n=0,r=e.length;r>n;n+=1)t._intervalSend(e[n]);else t._intervalSend(e)},this._interval)},r.prototype._intervalSend=function(t){var e=this;t=i.pack(t),i.blobToBinaryString(t,function(t){e._dc.send(t)}),0===e._queue.length&&(clearTimeout(e._timeout),e._timeout=null)},r.prototype._processAcks=function(){for(var t in this._outgoing)this._outgoing.hasOwnProperty(t)&&this._sendWindowedChunks(t)},r.prototype._handleSend=function(t){for(var e=!0,n=0,r=this._queue.length;r>n;n+=1){var i=this._queue[n];i===t?e=!1:i._multiple&&-1!==i.indexOf(t)&&(e=!1)}e&&(this._queue.push(t),this._timeout||this._setupInterval())},r.prototype._setupDC=function(){var t=this;this._dc.onmessage=function(e){var n=e.data,r=n.constructor;if(r===String){var o=i.binaryStringToArrayBuffer(n);n=i.unpack(o),t._handleMessage(n)}}},r.prototype._handleMessage=function(t){var e,n=t[1],r=this._incoming[n],o=this._outgoing[n];switch(t[0]){case"no":var a=n;a&&this.onmessage(i.unpack(a));break;case"end":if(e=r,this._received[n]=t[2],!e)break;this._ack(n);break;case"ack":if(e=o){var s=t[2];e.ack=Math.max(s,e.ack),e.ack>=e.chunks.length?(i.log("Time: ",new Date-e.timer),delete this._outgoing[n]):this._processAcks()}break;case"chunk":if(e=r,!e){var u=this._received[n];if(u===!0)break;e={ack:["ack",n,0],chunks:[]},this._incoming[n]=e}var c=t[2],f=t[3];e.chunks[c]=new Uint8Array(f),c===e.ack[2]&&this._calculateNextAck(n),this._ack(n);break;default:this._handleSend(t)}},r.prototype._chunk=function(t){for(var e=[],n=t.size,r=0;n>r;){var o=Math.min(n,r+this._mtu),a=t.slice(r,o),s={payload:a};e.push(s),r=o}return i.log("Created",e.length,"chunks."),e},r.prototype._ack=function(t){var e=this._incoming[t].ack;this._received[t]===e[2]&&(this._complete(t),this._received[t]=!0),this._handleSend(e)},r.prototype._calculateNextAck=function(t){for(var e=this._incoming[t],n=e.chunks,r=0,i=n.length;i>r;r+=1)if(void 0===n[r])return void(e.ack[2]=r);e.ack[2]=n.length},r.prototype._sendWindowedChunks=function(t){i.log("sendWindowedChunks for: ",t);for(var e=this._outgoing[t],n=e.chunks,r=[],o=Math.min(e.ack+this._window,n.length),a=e.ack;o>a;a+=1)n[a].sent&&a!==e.ack||(n[a].sent=!0,r.push(["chunk",t,a,n[a].payload]));e.ack+this._window>=n.length&&r.push(["end",t,n.length]),r._multiple=!0,this._handleSend(r)},r.prototype._complete=function(t){i.log("Completed called for",t);var e=this,n=this._incoming[t].chunks,r=new Blob(n);i.blobToArrayBuffer(r,function(t){e.onmessage(i.unpack(t))}),delete this._incoming[t]},r.higherBandwidthSDP=function(t){var e=navigator.appVersion.match(/Chrome\/(.*?) /);if(e&&(e=parseInt(e[1].split(".").shift()),31>e)){var n=t.split("b=AS:30"),r="b=AS:102400";if(n.length>1)return n[0]+r+n[1]}return t},r.prototype.onmessage=function(t){},e.exports.Reliable=r},{"./util":13}],13:[function(t,e,n){var r=t("js-binarypack"),i={debug:!1,inherits:function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})},extend:function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},pack:r.pack,unpack:r.unpack,log:function(){if(i.debug){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift("Reliable: "),console.log.apply(console,t)}},setZeroTimeout:function(t){function e(e){r.push(e),t.postMessage(i,"*")}function n(e){e.source==t&&e.data==i&&(e.stopPropagation&&e.stopPropagation(),r.length&&r.shift()())}var r=[],i="zero-timeout-message";return t.addEventListener?t.addEventListener("message",n,!0):t.attachEvent&&t.attachEvent("onmessage",n),e}(this),blobToArrayBuffer:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsArrayBuffer(t)},blobToBinaryString:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsBinaryString(t)},binaryStringToArrayBuffer:function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=255&t.charCodeAt(n);return e.buffer},randomToken:function(){return Math.random().toString(36).substr(2)}};e.exports=i},{"js-binarypack":10}]},{},[3]);var PeerIo;!function(t){var e=function(){function e(){}return e.prototype.state=function(){return t.PeerJsStateEnum.initial},e.prototype.network=function(e,n){n&&e.setStateObject(new t.OnlineState)},e.prototype.peer=function(t,e){},e}();t.OfflineState=e}(PeerIo||(PeerIo={}));var PeerIo;!function(t){var e=function(){function e(){}return e.prototype.state=function(){return t.PeerJsStateEnum.online},e.prototype.network=function(e,n){n||e.setStateObject(new t.OfflineState)},e.prototype.peer=function(e,n){n&&e.setStateObject(new t.ConnectedState)},e}();t.OnlineState=e}(PeerIo||(PeerIo={}));var PeerIo;!function(t){var e=function(){function e(){}return e.prototype.state=function(){return t.PeerJsStateEnum.connected},e.prototype.network=function(e,n){n||e.setStateObject(new t.WaitClosingState)},e.prototype.peer=function(e,n){n||e.setStateObject(new t.OnlineState)},e}();t.ConnectedState=e}(PeerIo||(PeerIo={}));var PeerIo;!function(t){var e=function(){function e(){}return e.prototype.state=function(){return t.PeerJsStateEnum.wait_closing},e.prototype.network=function(e,n){n&&e.setStateObject(new t.ConnectedState)},e.prototype.peer=function(e,n){n||e.setStateObject(new t.OfflineState)},e}();t.WaitClosingState=e}(PeerIo||(PeerIo={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},PeerIo;!function(t){!function(t){t[t.initial=1]="initial",t[t.online=2]="online",t[t.connected=3]="connected",t[t.wait_closing=4]="wait_closing"}(t.PeerJsStateEnum||(t.PeerJsStateEnum={}));var e=(t.PeerJsStateEnum,function(e){function n(){e.call(this),this._ON_STATE_CHANGED="onStateCahnged",this._state=new t.OfflineState}return __extends(n,e),n.prototype.state=function(){return this._state.state()},n.prototype.stateObject=function(){return this._state},n.prototype.setStateObject=function(t){this._state=t,this.emit(this._ON_STATE_CHANGED,t.state())},n.prototype.onStateChanged=function(t){this.on(this._ON_STATE_CHANGED,t)},n}(EventEmitter2));t.PeerJsStateManager=e}(PeerIo||(PeerIo={}));var PeerIo;!function(t){var e=function(){function e(){}return e.waitTime=function(t,e){return t+Math.random()*(e-t)},e.key=function(e,n){switch(n){case t.NeighbourTypeEnum.video:return e+"-video";case t.NeighbourTypeEnum.data:return e+"-data"}},e.isDataChannel=function(t){return t&&t.hasOwnProperty("reliable")},e.isMediaConnection=function(t){return t&&t.hasOwnProperty("localStream")},e.isMediaStream=function(t){return t&&"active"in t&&"id"in t},e}();t.Util=e}(PeerIo||(PeerIo={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},PeerIo;!function(t){!function(t){t[t.video=1]="video",t[t.data=2]="data"}(t.NeighbourTypeEnum||(t.NeighbourTypeEnum={}));var e=(t.NeighbourTypeEnum,function(e){function n(t,n){e.call(this),this.peerId_=t,this.type_=n,this.sources_=[],this.option_={label:"json",serialization:"none",reliable:!1},this.isEstablished=function(){throw"this method should be overwrite."},this.addLink=function(t){throw"this method should be overwrite."},console.log("create neighbour record "+t+" type "+n)}return __extends(n,e),n.prototype.type=function(){return this.type_},n.prototype.peerID=function(){return this.peerId_},n.prototype.streams=function(){return this.sources_},n.prototype.setStream=function(e){console.log("setstream"),e instanceof Array?(console.log("array"),console.log(e[0].getVideoTracks()),Array.prototype.push.apply(this.sources_,e)):t.Util.isMediaStream(e)&&(console.log("stream"),console.log(e.getVideoTracks()),this.sources_.push(e))},n.prototype.dataChannelOption=function(){return this.option_},n.prototype.setDataChannelOption=function(t){this.option_=t},n.prototype.key=function(){return t.Util.key(this.peerId_,this.type_)},n}(EventEmitter2));t.NeighbourRecord=e}(PeerIo||(PeerIo={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},PeerIo;!function(t){var e=function(e){function n(){var t=this;e.call(this),this.NEED_ESTABLISH_LINK="need-establish-link-in-neighbourstore",this.recordsHash_={},this.linksHash_={},this.neighbours=function(){return t.recordsHash_}}return __extends(n,e),n.prototype.addRecord_=function(t){t.isEstablished=this.isEstablished_.bind(this,t.key()),t.addLink=this.addLink_.bind(this,t.key()),this.recordsHash_[t.key()]=t},n.prototype.addRecord=function(t){t.key()in this.recordsHash_?this.recordsHash_[t.key()].isEstablished()||this.emit(this.NEED_ESTABLISH_LINK,this.recordsHash_[t.key()]):(this.addRecord_(t),this.emit(this.NEED_ESTABLISH_LINK,t))},n.prototype.removeRecord=function(t){t.key()in this.linksHash_&&(this.linksHash_[t.key()].close(),delete this.linksHash_[t.key()]),t.key()in this.recordsHash_&&delete this.recordsHash_[t.key()]},n.prototype.addLink=function(e){if(!(e.key()in this.recordsHash_)){var n=new t.NeighbourRecord(e.peerID(),e.type());this.addRecord_(n)}this.linksHash_[e.key()]=e},n.prototype.findLink=function(t){return this.linksHash_[t]},n.prototype.links=function(){return _.reduce(this.linksHash_,function(t,e,n){return t.concat(e)},[])},n.prototype.addLink_=function(t,e){this.isEstablished_(t)&&this.linksHash_[t].close(),this.linksHash_[t]=e},n.prototype.isEstablished_=function(t){return t in this.linksHash_?this.linksHash_[t].isEstablished():!1},n}(EventEmitter2);t.NeighbourStore=e}(PeerIo||(PeerIo={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},PeerIo;!function(t){var e=function(e){function n(t,n){e.call(this),this.peerID_=t,this.link_=n,this.OnStopVideo="onStopVideo-in-peer.io.ts",this.OnDataLinkDown="onDataLinkDown-in-link_component.ts",this.OnRecvData="onRecvData-in-link_component.ts"}return __extends(n,e),n.prototype.type=function(){return null},n.prototype.peerID=function(){return this.peerID_},n.prototype.key=function(){return t.Util.key(this.peerID_,this.type())},n.prototype.isEstablished=function(){return!1},n.prototype.send=function(t){},n.prototype.close=function(){},n}(EventEmitter2);t.LinkComponentTemplate=e;var n=function(e){function n(t,n){var r=this;e.call(this,t,n),this.peerID_=t,this.link_=n,n.on("close",function(){r.link_=null,r.emit(r.OnDataLinkDown)}),n.on("error",function(t){r.link_=null}),n.on("data",function(t){r.emit(r.OnRecvData,t)})}return __extends(n,e),n.prototype.type=function(){return t.NeighbourTypeEnum.data},n.prototype.isEstablished=function(){return this.link_&&this.link_.open?this.link_.open:!1},n.prototype.send=function(t){this.isEstablished()&&this.link_&&this.link_.send(t)},n.prototype.close=function(){this.link_&&this.link_.close(),this.link_=null},n.prototype.options=function(){return{metadata:this.link_.metadata,serialization:this.link_.serialization,reliable:this.link_.reliable}},n}(e);t.DataLinkComponent=n;var r=function(e){function n(t,n){var r=this;e.call(this,t,n),this.peerID_=t,this.link_=n,this._sources=[],n.on("close",function(){r.link_=null,r.emit(r.OnStopVideo)}),n.on("error",function(t){r.link_=null})}return __extends(n,e),n.prototype.type=function(){return t.NeighbourTypeEnum.video},n.prototype.isEstablished=function(){return this.link_&&this.link_.open?this.link_.open:!1},n.prototype.sources=function(){return this._sources},n.prototype.setSource=function(t){t instanceof Array?Array.prototype.push.apply(this._sources,t):this._sources.push(t)},n.prototype.close=function(){this.link_&&this.link_.close(),this.link_=null},n}(e);t.VideoLinkComponent=r;var i=function(){function e(){}return e.createLinkComponent=function(e,i){return t.Util.isDataChannel(i)?new n(e,i):t.Util.isMediaConnection(i)?new r(e,i):null},e}();t.LinkComponentFactory=i}(PeerIo||(PeerIo={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},PeerIo;!function(t){var e=function(e){function n(n){var r=this;e.call(this),this.peer_=n,this.OnNewMediaStream="on-new-mediastream-in-link_generator.ts",this.OnNewDataChannel="on-new-datachannel-in-link_generator.ts",this.neighbourSourceHash_={},this.onStateChanged_=function(e){switch(e){case t.PeerJsStateEnum.initial:break;case t.PeerJsStateEnum.online:r.peer_.disconnected||r.state_.stateObject().peer(r.state_,!0);break;case t.PeerJsStateEnum.connected:setTimeout(r._establishAllPeer,t.Util.waitTime(2e3,5e3));break;case t.PeerJsStateEnum.wait_closing:}},this.establishLink=function(e){switch(e.type()){case t.NeighbourTypeEnum.video:r.tryCall_(e);break;case t.NeighbourTypeEnum.data:r.tryConnect_(e)}},this._establishAllPeer=function(){_.each(r.targetNeighbours_(),r.establishLink)},this.onRecvCall_=function(e){var n=e.peer,i=r.findNeighbour_(t.Util.key(n,t.NeighbourTypeEnum.video)),o=r.defaultStream_;if(i){var a=i.streams();a&&a.length>0&&(o=a[0])}e.answer(o),e.on("stream",function(i){var o=t.LinkComponentFactory.createLinkComponent(n,e);r.emit(r.OnNewMediaStream,o,i)})},this.onRecvConnect_=function(e){var n=e.peer;e.on("open",function(){var i=t.LinkComponentFactory.createLinkComponent(n,e);r.emit(r.OnNewDataChannel,i)})},this.state_=new t.PeerJsStateManager,this.state_.onStateChanged(this.onStateChanged_),this.checkNetworkStatus_(),this.wrapPeerEvent_()}return __extends(n,e),n.prototype.setDefaultStream=function(t){this.defaultStream_=t},n.prototype.addNeighbourSource=function(t,e){this.neighbourSourceHash_[t]=e},n.prototype.removeNeighbourSource=function(t){t in this.neighbourSourceHash_&&delete this.neighbourSourceHash_[t]},n.prototype.checkNetworkStatus_=function(){var t=this;Offline.options={checks:{xhr:{url:"https://skyway.io/dist/0.3/peer.min.js"}}},Offline.on("up",function(){t.state_.stateObject().network(t.state_,!0)}),Offline.on("down",function(){t.state_.stateObject().network(t.state_,!1)}),"up"===Offline.state&&this.state_.stateObject().network(this.state_,!0),Offline.check()},n.prototype.wrapPeerEvent_=function(){var t=this;this.peer_.on("open",function(){t.state_.stateObject().peer(t.state_,!0)}),this.peer_.on("error",function(t){console.log(t)}),this.peer_.on("disconnected",function(){t.state_.stateObject().peer(t.state_,!1)}),this.peer_.on("connection",this.onRecvConnect_),this.peer_.on("call",this.onRecvCall_)},n.prototype.findNeighbour_=function(t){var e=_.find(this.neighbourSourceHash_,function(e){return t in e()});return e?e()[t]:null},n.prototype.neighbourArray_=function(){return _.reduce(this.neighbourSourceHash_,function(t,e,n){return _.reduce(e(),function(t,e,n){return t.concat(e)},t)},[])},n.prototype.targetNeighbours_=function(){var t=this.neighbourArray_();return _.filter(t,function(t){return!t.isEstablished()})},n.prototype.tryCall_=function(e){var n=this,r=e.streams(),i=this.defaultStream_;r&&r.length>0&&(i=r[0]);var o=this.peer_.call(e.peerID(),i);o&&o.on("stream",function(r){var i=t.LinkComponentFactory.createLinkComponent(e.peerID(),o);n.emit(n.OnNewMediaStream,i,r)})},n.prototype.tryConnect_=function(e){var n=this,r=this.peer_.connect(e.peerID(),e.dataChannelOption());r&&r.on("open",function(){var i=t.LinkComponentFactory.createLinkComponent(e.peerID(),r);n.emit(n.OnNewDataChannel,i)})},n}(EventEmitter2);t.LinkGenerator=e}(PeerIo||(PeerIo={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},PeerIo;!function(t){t.OnStartVideo="onStartVideo-in-peer.io.ts",t.OnStopVideo="onStopVideo-in-peer.io.ts",t.OnDataLinkUp="onDataLinkUp",t.OnDataLinkDown="onDataLinkDown",t.OnRecvData="onRecvData";var e=function(e){function n(n){var r=this;e.call(this),this.peerJs_=n,this.newDataChannel_=function(e){r.neighbourStore_.addLink(e),r.emit(t.OnDataLinkUp,e.peerID(),e.options()),e.on(e.OnRecvData,function(n){r.emit(t.OnRecvData,e.peerID(),n)}),e.on(e.OnDataLinkDown,function(){r.emit(t.OnStopVideo,e.peerID())})},this.newMediaStream_=function(e,n){r.neighbourStore_.addLink(e),r.emit(t.OnStartVideo,e.peerID(),n),e.on(e.OnStopVideo,function(){r.emit(t.OnStopVideo,e.peerID())})},this.neighbourStore_=new t.NeighbourStore,this.linkGenerator_=new t.LinkGenerator(n),this.linkGenerator_.addNeighbourSource("neighbourSource",this.neighbourStore_.neighbours),this.linkGenerator_.on(this.linkGenerator_.OnNewDataChannel,this.newDataChannel_),this.linkGenerator_.on(this.linkGenerator_.OnNewMediaStream,this.newMediaStream_),this.neighbourStore_.on(this.neighbourStore_.NEED_ESTABLISH_LINK,this.linkGenerator_.establishLink)}return __extends(n,e),n.prototype.addDefaultStream=function(t){this.linkGenerator_.setDefaultStream(t)},n.prototype.addVideoNeighbour=function(e,n){var r=new t.NeighbourRecord(e,t.NeighbourTypeEnum.video);n&&r.setStream(n),this.neighbourStore_.addRecord(r)},n.prototype.addDataNeighbour=function(e,n){var r=new t.NeighbourRecord(e,t.NeighbourTypeEnum.data);n&&r.setDataChannelOption(n),this.neighbourStore_.addRecord(r)},n.prototype.removeVideoNeighbour=function(e){this.neighbourStore_.removeRecord(new t.NeighbourRecord(e,t.NeighbourTypeEnum.video))},n.prototype.removeDataNeighbour=function(e){this.neighbourStore_.removeRecord(new t.NeighbourRecord(e,t.NeighbourTypeEnum.data))},n.prototype.send=function(t,e){var n=this.neighbourStore_.findLink(t+"-data");n&&n.send(e)},n.prototype.broadcast=function(t){var e=this.neighbourStore_.links();_.each(e,function(e){e.send(t)})},n}(EventEmitter2);t.PeerIo=e}(PeerIo||(PeerIo={})),THREE.StereoEffect=function(t){var e=new THREE.StereoCamera;e.aspect=.5,this.setSize=function(e,n){t.setSize(e,n)},this.render=function(n,r){n.updateMatrixWorld(),null===r.parent&&r.updateMatrixWorld(),e.update(r);var i=t.getSize();t.setScissorTest(!0),t.clear(),t.setScissor(0,0,i.width/2,i.height),t.setViewport(0,0,i.width/2,i.height),t.render(n,e.cameraL),t.setScissor(i.width/2,0,i.width/2,i.height),t.setViewport(i.width/2,0,i.width/2,i.height),t.render(n,e.cameraR),t.setScissorTest(!1)}};var DeviceOrientationController=function(t,e){var n=this;this.object=t,this.element=e||document,this.freeze=!0,this.enableManualDrag=!0,this.enableManualZoom=!0,this.useQuaternions=!0,this.deviceOrientation={},this.screenOrientation=window.orientation||0;var r,i,o,a,s,u=0,c=0,f=0,l=0,h=new THREE.Quaternion,p=1,d=1,_=new THREE.Vector2,v=new THREE.Vector2,g={AUTO:0,MANUAL_ROTATE:1,MANUAL_ZOOM:2},y=g.AUTO,m={CALIBRATE_COMPASS:"compassneedscalibration",SCREEN_ORIENTATION:"orientationchange",MANUAL_CONTROL:"userinteraction",ZOOM_CONTROL:"zoom",ROTATE_CONTROL:"rotate"},w=window.innerHeight,b=2e3*Math.tan(THREE.Math.degToRad((this.object.fov||75)/2)),k=new THREE.Quaternion,E=function(){var t;return function(e){t=arguments||{},t.type=e,t.target=this,this.dispatchEvent(t)}.bind(this)}.bind(this)();this.constrainObjectFOV=function(){a=b*(window.innerHeight/w),s=THREE.Math.radToDeg(2*Math.atan(a/2e3)),this.object.fov=s}.bind(this),this.onDeviceOrientationChange=function(t){this.deviceOrientation=t}.bind(this),this.onScreenOrientationChange=function(){this.screenOrientation=window.orientation||0,E(m.SCREEN_ORIENTATION)}.bind(this),this.onCompassNeedsCalibration=function(t){t.preventDefault(),E(m.CALIBRATE_COMPASS)}.bind(this),this.onDocumentMouseDown=function(t){this.enableManualDrag===!0&&(t.preventDefault(),y=g.MANUAL_ROTATE,this.freeze=!0,h.copy(this.object.quaternion),u=f=t.pageX,c=l=t.pageY,r=1200/window.innerWidth*.2,i=800/window.innerHeight*.2,this.element.addEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.addEventListener("mouseup",this.onDocumentMouseUp,!1),E(m.MANUAL_CONTROL+"start"),E(m.ROTATE_CONTROL+"start"))}.bind(this),this.onDocumentMouseMove=function(t){f=t.pageX,l=t.pageY}.bind(this),this.onDocumentMouseUp=function(t){this.element.removeEventListener("mousemove",this.onDocumentMouseMove,!1),this.element.removeEventListener("mouseup",this.onDocumentMouseUp,!1),y=g.AUTO,this.freeze=!1,E(m.MANUAL_CONTROL+"end"),E(m.ROTATE_CONTROL+"end")}.bind(this),this.onDocumentTouchStart=function(t){switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:if(this.enableManualDrag!==!0)return;y=g.MANUAL_ROTATE,this.freeze=!0,h.copy(this.object.quaternion),u=f=t.touches[0].pageX,c=l=t.touches[0].pageY,r=1200/window.innerWidth*.1,i=800/window.innerHeight*.1,this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),E(m.MANUAL_CONTROL+"start"),E(m.ROTATE_CONTROL+"start");break;case 2:if(this.enableManualZoom!==!0)return;y=g.MANUAL_ZOOM,this.freeze=!0,o=this.object.fov,_.set(t.touches[0].pageX,t.touches[0].pageY),v.set(t.touches[1].pageX,t.touches[1].pageY),p=d=_.distanceTo(v),this.element.addEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.addEventListener("touchend",this.onDocumentTouchEnd,!1),E(m.MANUAL_CONTROL+"start"),E(m.ZOOM_CONTROL+"start")}}.bind(this),this.onDocumentTouchMove=function(t){switch(t.touches.length){case 1:f=t.touches[0].pageX,l=t.touches[0].pageY;break;case 2:_.set(t.touches[0].pageX,t.touches[0].pageY),v.set(t.touches[1].pageX,t.touches[1].pageY)}}.bind(this),this.onDocumentTouchEnd=function(t){this.element.removeEventListener("touchmove",this.onDocumentTouchMove,!1),this.element.removeEventListener("touchend",this.onDocumentTouchEnd,!1),y===g.MANUAL_ROTATE?(y=g.AUTO,this.freeze=!1,E(m.MANUAL_CONTROL+"end"),E(m.ROTATE_CONTROL+"end")):y===g.MANUAL_ZOOM&&(this.constrainObjectFOV(),y=g.AUTO,this.freeze=!1,E(m.MANUAL_CONTROL+"end"),E(m.ZOOM_CONTROL+"end"))}.bind(this);var O=function(){var t=new THREE.Quaternion,e=new THREE.Euler,n=new THREE.Quaternion,r=new THREE.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5)),i=0;return function(o,a,s,u){return e.set(a,o,-s,"YXZ"),t.setFromEuler(e),i=-u/2,n.set(0,Math.sin(i),0,Math.cos(i)),t.multiply(n),t.multiply(r),t}}(),S=function(){var t=new THREE.Matrix4,e=new THREE.Euler,n=new THREE.Euler,r=new THREE.Euler(-Math.PI/2,0,0,"YXZ"),i=new THREE.Matrix4,o=new THREE.Matrix4;
return o.makeRotationFromEuler(r),function(r,a,s,u){return e.set(a,r,-s,"YXZ"),t.identity(),t.makeRotationFromEuler(e),n.set(0,-u,0,"YXZ"),i.identity(),i.makeRotationFromEuler(n),t.multiply(i),t.multiply(o),t}}();this.updateManualMove=function(){var t,e,n,a,s,m,w,b,E=new THREE.Euler(0,0,0,"YXZ"),O=new THREE.Quaternion,S=new THREE.Quaternion,T=1;return function(){S.copy(h),y===g.MANUAL_ROTATE?(t=(c-l)*i,e=(u-f)*r,n=THREE.Math.degToRad(t),a=THREE.Math.degToRad(e),O.set(0,Math.sin(a/2),0,Math.cos(a/2)),S.multiply(O),O.set(Math.sin(n/2),0,0,Math.cos(n/2)),S.multiply(O),s=E.setFromQuaternion(h,"YXZ").z,m=E.setFromQuaternion(S,"YXZ").z,w=E.setFromQuaternion(k||h,"YXZ").z,O.set(0,0,Math.sin((w-s)/2),Math.cos((w-s)/2)),h.multiply(O),O.set(0,0,Math.sin((w-m)/2),Math.cos((w-m)/2)),S.multiply(O),this.object.quaternion.copy(S)):y===g.MANUAL_ZOOM&&(d=_.distanceTo(v),b=p/d,T>=b&&(this.object.fov=o*b,this.object.updateProjectionMatrix()),k&&(s=E.setFromQuaternion(h,"YXZ").z,w=E.setFromQuaternion(k,"YXZ").z,O.set(0,0,Math.sin((w-s)/2),Math.cos((w-s)/2)),h.multiply(O),this.object.quaternion.copy(h)))}}(),this.updateDeviceMove=function(){var t,e,r,i,o;return function(){if(t=THREE.Math.degToRad(this.deviceOrientation.alpha||0),e=THREE.Math.degToRad(this.deviceOrientation.beta||0),r=THREE.Math.degToRad(this.deviceOrientation.gamma||0),i=THREE.Math.degToRad(this.screenOrientation||0),0!==t&&0!==e&&0!==r){if(this.useQuaternions?k=O(t,e,r,i):(o=S(t,e,r,i),k.setFromRotationMatrix(o)),n.onCardBoard(k),this.freeze)return;this.object.quaternion.copy(k)}}}(),this.update=function(){this.updateDeviceMove(),y!==g.AUTO&&this.updateManualMove()},this.connect=function(){window.addEventListener("resize",this.constrainObjectFOV,!1),window.addEventListener("orientationchange",this.onScreenOrientationChange,!1),window.addEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.addEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.addEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.addEventListener("touchstart",this.onDocumentTouchStart,!1),this.freeze=!1},this.disconnect=function(){this.freeze=!0,window.removeEventListener("resize",this.constrainObjectFOV,!1),window.removeEventListener("orientationchange",this.onScreenOrientationChange,!1),window.removeEventListener("deviceorientation",this.onDeviceOrientationChange,!1),window.removeEventListener("compassneedscalibration",this.onCompassNeedsCalibration,!1),this.element.removeEventListener("mousedown",this.onDocumentMouseDown,!1),this.element.removeEventListener("touchstart",this.onDocumentTouchStart,!1)}};DeviceOrientationController.prototype=Object.create(THREE.EventDispatcher.prototype);var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},TexCardBoard;!function(t){var e=function(){function t(){this.alpha=0,this.gamma=0,this.type="CardBoard"}return t}();t.Orientation=e;var n=function(t){function n(){var r=this;t.call(this);var i=function(t){if(t.alpha){var i=new e,o=t.alpha,a=t.gamma;a>0?(o-=180,a=90-a):a=-90-a,i.alpha=(o+180)%360,i.gamma=a,r.emit(n.OnDeviceOrientation,i)}};window.addEventListener("deviceorientation",i,!0)}return __extends(n,t),n.prototype.movingAverage=function(t){},n.OnDeviceOrientation="onDeviceOrientation-AndroidDevice.ts",n}(EventEmitter2);t.AndroidDevice=n}(TexCardBoard||(TexCardBoard={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},TexCardBoard;!function(t){var e=function(){function e(){var e=this;this.offset_=0,this.data=[];for(var n=0;4>n;n++){var r=new t.Orientation;r.alpha=0,r.gamma=0,this.data.push(r)}var i=document.getElementById("calibration");i.addEventListener("click",function(){e.offset_=e.data[3].alpha-180})}return e.prototype.push=function(t){this.data=this.data.slice(1),this.data.push(t)},e.prototype.averageNum=function(t,e){return Math.abs(t-e)<180?(t+e)/2:(t+e+360)/2},e.prototype.averageOrientation=function(e,n){var r=new t.Orientation;return r.alpha=this.averageNum(e.alpha,n.alpha),r.gamma=this.averageNum(e.gamma,n.gamma),r},e.prototype.average=function(){var t=this.averageOrientation(this.data[0],this.data[1]),e=this.averageOrientation(this.data[2],this.data[3]),n=this.averageOrientation(t,e);return n.alpha=(n.alpha-this.offset_+360)%360,n.alpha-=180,n},e.prototype.tail=function(){var e=new t.Orientation;return e.alpha=this.data[3].alpha,e.gamma=this.data[3].gamma,e.alpha=(e.alpha-this.offset_+360)%360,e.alpha-=180,document.getElementById("debug").innerHTML=e.alpha+"<br />"+e.gamma+"<br/>"+this.offset_,e},e}(),n=function(t){function n(n){var r=this;t.call(this),this.orientationManager_=new e,this.transmit_=function(){var t=r.orientationManager_.tail();r.peerIo_&&r.peerIo_.broadcast(JSON.stringify(t))},navigator.mediaDevices.enumerateDevices().then(function(t){var e=_.find(t,function(t){return"Bluetooth headset"===t.label});e?(console.log(e.deviceId),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({audio:{optional:[{sourceId:e.deviceId}]},video:!1},function(t){console.log("getusermedia"),r.init(n,t)},function(t){console.log(t)})):document.getElementById("log").innerHTML="<h1>bluetooth not connected</h1>",console.log("find"),console.log(e)},function(t){console.log(t)})}return __extends(n,t),n.prototype.init=function(t,e){var r=this,i=new Peer({config:{iceServers:[{urls:"stun:stun.skyway.io:3478"}]},host:"robo.paas.jp-e1.cloudn-service.com",port:443,secure:!0,key:"DEl4XWDPustUHICCl8cZ",debug:0});i.listAllPeers(function(e){console.log("listallpeers"),console.log(e);var n=_.filter(e,function(e){return console.log(e),console.log(t),0===e.indexOf(t)}),i=n.sort();console.log(i[i.length-1]),r.peerIo_.addDataNeighbour(i[i.length-1])}),this.peerIo_=new PeerIo.PeerIo(i),this.peerIo_.addDefaultStream(e),this.peerIo_.on(PeerIo.OnRecvData,function(t,e){}),this.peerIo_.on(PeerIo.OnDataLinkUp,function(t){console.log("establish data link with "+t);var e={};e.peerId=i.id,e.type="callbackRequest",console.log("send"),r.peerIo_.send(t,JSON.stringify(e))}),this.peerIo_.on(PeerIo.OnStartVideo,function(t,e){console.log(e),r.emit(n.onVideo,e)}),setInterval(this.transmit_,1e3/30)},n.prototype.append=function(t){this.orientationManager_.push(t)},n.onVideo="onVideo-in-network.ts",n}(EventEmitter2);t.Network=n}(TexCardBoard||(TexCardBoard={}));var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},TexCardBoard;!function(t){var e=function(){function t(){this.alpha=0,this.gamma=0,this.type="CardBoard"}return t}();t.Orientation=e;var n=function(t){function e(e){var n=this;t.call(this),this.video=e,this.contentWidth=500,this.contentHeight=400,this.init=function(){n.renderer=new THREE.WebGLRenderer,n.element=n.renderer.domElement,n.container=document.getElementById("example"),n.container.appendChild(n.element),n.effect=new THREE.StereoEffect(n.renderer),n.scene=new THREE.Scene,n.camera=new THREE.PerspectiveCamera(90,1,.001,1e3),n.camera.position.set(0,0,-10),n.camera.lookAt(new THREE.Vector3(0,0,0)),n.scene.add(n.camera),n.element.addEventListener("click",n.fullscreen,!1);var t=new THREE.AmbientLight(16777215);n.scene.add(t);var e=new THREE.VideoTexture(n.video);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.format=THREE.RGBFormat;var r=new THREE.MeshPhongMaterial({color:16777215,specular:16777215,shininess:20,shading:THREE.FlatShading,map:e}),i=new THREE.PlaneGeometry(640,480);n.mesh=new THREE.Mesh(i,r),n.mesh.rotation.x=-Math.PI,n.mesh.rotation.z=-Math.PI,n.mesh.position.set(0,0,900),n.scene.add(n.mesh);var o=new THREE.AxisHelper(10);o.position.set(0,0,0),window.addEventListener("resize",n.resize,!1),setTimeout(n.resize,1),document.addEventListener("webkitfullscreenchange",function(){document.webkitFullscreenElement&&null!==document.webkitFullscreenElement?(n.contentWidth=screen.width,n.contentHeight=screen.height*window.devicePixelRatio):(n.contentWidth=500,n.contentHeight=400)},!1)},this.resize=function(){n.camera.aspect=n.contentWidth/n.contentHeight,n.camera.updateProjectionMatrix(),n.renderer.setSize(n.contentWidth,n.contentHeight),n.effect.setSize(n.contentWidth,n.contentHeight)},this.update=function(t){n.resize(),n.camera.updateProjectionMatrix()},this.render=function(t){n.effect.render(n.scene,n.camera)},this.animate=function(){requestAnimationFrame(n.animate),n.update(n.clock.getDelta()),n.render(n.clock.getDelta())},this.fullscreen=function(){n.container.requestFullscreen?n.container.requestFullscreen():n.container.msRequestFullscreen?n.container.msRequestFullscreen():n.container.mozRequestFullScreen?n.container.mozRequestFullScreen():n.container.webkitRequestFullscreen&&n.container.webkitRequestFullscreen()},this.clock=new THREE.Clock,this.init(),this.animate()}return __extends(e,t),e.OnOrientation="onOrientation-in-cardboard.ts",e}(EventEmitter2);t.CardBoard=n}(TexCardBoard||(TexCardBoard={}));var TexCardBoard;!function(t){var e=function(){function e(){var e=this,n=getQueryString();n||(n={id:"oculus",prefix:"pepper_",target:"robot"});var r=n.prefix;this.network=new t.Network(r),this.android=new t.AndroidDevice,this.android.on(t.AndroidDevice.OnDeviceOrientation,function(t){e.network.append(t)}),this.network.on(t.Network.onVideo,function(n){var r=document.getElementById("video");r.src=window.URL.createObjectURL(n);var i=new t.CardBoard(r);i.on(t.CardBoard.OnOrientation,function(t){e.network.append(t)})})}return e}();t.Controller=e}(TexCardBoard||(TexCardBoard={})),window.onload=function(){new TexCardBoard.Controller};